<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Thirdia Chronicles - Pilih Role Anda</title>
    
    <!-- Primary Meta Tags -->
    <meta name="title" content="Thirdia Chronicles - Pilih Role Anda">
    <meta name="description" content="Sebuah Kerajaan Fantasi Yang Akan Kalian Jelajahi. Pilih role petualangan Anda dan mulai perjalanan epik di Thirdia Chronicles!">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://thirdia-chronicles.com">
    <meta property="og:title" content="Thirdia Chronicles - Pilih Role Anda">
    <meta property="og:description" content="Sebuah Kerajaan Fantasi Yang Akan Kalian Jelajahi. Pilih role petualangan Anda dan mulai perjalanan epik di Thirdia Chronicles!">
    <meta property="og:image" content="https://raw.githubusercontent.com/aprelryu21/thirdia-chronicles-games/dce9c9f2bb73490661b05f3a40f9591e90a7e6bf/thumbnail.png">
    <meta property="og:image:secure_url" content="https://raw.githubusercontent.com/aprelryu21/thirdia-chronicles-games/dce9c9f2bb73490661b05f3a40f9591e90a7e6bf/thumbnail.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Thirdia Chronicles - Game Petualangan Fantasi">
    <meta property="og:site_name" content="Thirdia Chronicles">
    <meta property="og:locale" content="id_ID">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://thirdia-chronicles.com">
    <meta name="twitter:title" content="Thirdia Chronicles - Pilih Role Anda">
    <meta name="twitter:description" content="Sebuah Kerajaan Fantasi Yang Akan Kalian Jelajahi. Pilih role petualangan Anda dan mulai perjalanan epik di Thirdia Chronicles!">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/aprelryu21/thirdia-chronicles-games/dce9c9f2bb73490661b05f3a40f9591e90a7e6bf/thumbnail.png">
    <meta name="twitter:image:alt" content="Thirdia Chronicles - Game Petualangan Fantasi">
    
    <!-- WhatsApp specific -->
    <meta property="og:image:url" content="https://raw.githubusercontent.com/aprelryu21/thirdia-chronicles-games/dce9c9f2bb73490661b05f3a40f9591e90a7e6bf/thumbnail.png">
    
    <!-- Additional meta for better sharing -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="Thirdia Chronicles">
    <meta name="keywords" content="game, petualangan, fantasi, role playing, thirdia chronicles">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/aprelryu21/thirdia-chronicles-games/dce9c9f2bb73490661b05f3a40f9591e90a7e6bf/thumbnail.png">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/aprelryu21/thirdia-chronicles-games/dce9c9f2bb73490661b05f3a40f9591e90a7e6bf/thumbnail.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Orbitron:wght@400;700&display=swap');
        
        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .mobile-text-sm { font-size: 0.875rem; }
            .mobile-text-base { font-size: 1rem; }
            .mobile-text-lg { font-size: 1.125rem; }
            .mobile-text-xl { font-size: 1.25rem; }
            .mobile-text-2xl { font-size: 1.5rem; }
            .mobile-text-3xl { font-size: 1.875rem; }
            .mobile-text-4xl { font-size: 2.25rem; }
            
            .mobile-p-2 { padding: 0.5rem; }
            .mobile-p-4 { padding: 1rem; }
            .mobile-p-6 { padding: 1.5rem; }
            .mobile-p-8 { padding: 2rem; }
            
            .mobile-m-2 { margin: 0.5rem; }
            .mobile-m-4 { margin: 1rem; }
            
            .mobile-w-full { width: 100%; }
            .mobile-h-auto { height: auto; }
            
            .mobile-grid-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
            .mobile-grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            
            .mobile-gap-2 { gap: 0.5rem; }
            .mobile-gap-4 { gap: 1rem; }
            
            .mobile-hidden { display: none; }
            .mobile-block { display: block; }
        }
        
        body {
            font-family: 'Cinzel', serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b69 100%);
            overflow-x: hidden;
        }
        
        .game-title {
            font-family: 'Orbitron', monospace;
            text-shadow: 0 0 20px #4f46e5, 0 0 40px #4f46e5;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px #4f46e5, 0 0 40px #4f46e5; }
            to { text-shadow: 0 0 30px #7c3aed, 0 0 60px #7c3aed; }
        }
        
        .role-card {
            background: linear-gradient(145deg, rgba(15, 15, 35, 0.95), rgba(30, 30, 60, 0.9));
            border: 2px solid rgba(100, 100, 150, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
        }
        
        .role-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .role-card:hover::before {
            left: 100%;
        }
        
        .role-card:hover {
            transform: translateY(-15px) scale(1.08);
            border: 2px solid #fbbf24;
            box-shadow: 
                0 25px 50px rgba(251, 191, 36, 0.4),
                0 0 30px rgba(251, 191, 36, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            background: linear-gradient(145deg, rgba(25, 25, 45, 0.95), rgba(40, 40, 80, 0.9));
        }
        
        .role-card.selected {
            border: 3px solid #10b981;
            box-shadow: 
                0 0 40px rgba(16, 185, 129, 0.6),
                0 0 80px rgba(16, 185, 129, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: scale(1.12);
            background: linear-gradient(145deg, rgba(16, 185, 129, 0.1), rgba(30, 30, 60, 0.9));
        }
        
        .role-card.selected::after {
            content: '✓';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #10b981;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            animation: checkmark 0.3s ease-out;
        }
        
        @keyframes checkmark {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .role-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 1rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
            transition: all 0.3s ease;
        }
        
        .role-card:hover .role-icon {
            transform: scale(1.1);
            filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.4));
        }
        
        .stats-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .stats-fill {
            height: 6px;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
            border-radius: 10px;
            transition: width 0.8s ease-out;
        }
        
        .role-title {
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .hexagon {
            width: 120px;
            height: 120px;
            position: relative;
            margin: 0 auto 1rem;
        }
        
        .hexagon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(251, 191, 36, 0.1), rgba(139, 92, 246, 0.1));
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            border: 2px solid rgba(251, 191, 36, 0.3);
            transition: all 0.3s ease;
        }
        
        .role-card:hover .hexagon::before {
            background: linear-gradient(45deg, rgba(251, 191, 36, 0.2), rgba(139, 92, 246, 0.2));
            border-color: rgba(251, 191, 36, 0.6);
        }
        
        .hexagon-modal {
            width: 120px;
            height: 120px;
            position: relative;
            margin: 0 auto;
        }
        
        .hexagon-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(16, 185, 129, 0.3), rgba(251, 191, 36, 0.3));
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            border: 3px solid rgba(16, 185, 129, 0.8);
            animation: modalGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes modalGlow {
            from { 
                border-color: rgba(16, 185, 129, 0.8);
                box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
            }
            to { 
                border-color: rgba(251, 191, 36, 0.8);
                box-shadow: 0 0 30px rgba(251, 191, 36, 0.4);
            }
        }
        
        .role-icon-modal {
            width: 120px;
            height: 120px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }
        
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .confirm-btn {
            background: linear-gradient(45deg, #10b981, #059669);
            transition: all 0.3s ease;
        }
        
        .confirm-btn:hover {
            background: linear-gradient(45deg, #059669, #047857);
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }
        
        .gender-option input:checked + .gender-card {
            border-color: #fbbf24;
            background: linear-gradient(145deg, rgba(251, 191, 36, 0.2), rgba(251, 191, 36, 0.1));
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <!-- Animated Stars Background -->
    <div class="stars" id="stars"></div>
    
    <!-- Fullscreen Toggle Button (Always Visible) -->
    <div class="fixed top-2 sm:top-4 right-2 sm:right-4 z-50">
        <button id="fullscreenBtn" onclick="toggleFullscreen()" 
                class="w-10 h-10 sm:w-12 sm:h-12 bg-black bg-opacity-70 hover:bg-opacity-90 rounded-lg border-2 border-yellow-400 hover:border-yellow-300 flex items-center justify-center text-yellow-400 hover:text-yellow-300 transition-all duration-300 shadow-lg">
            <svg id="fullscreenIcon" viewBox="0 0 24 24" class="w-5 h-5 sm:w-6 sm:h-6 fill-current">
                <!-- Expand Icon (default) -->
                <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
            </svg>
        </button>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Admin Access (Hidden) -->
        <div id="adminAccess" class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-95 flex items-center justify-center hidden z-50">
            <div class="bg-gradient-to-br from-red-900 to-gray-900 p-6 md:p-8 rounded-2xl border-2 border-red-400 text-center max-w-md w-full mx-4">
                <div class="text-4xl mb-4">🔐</div>
                <h2 class="text-2xl font-bold mb-4 text-red-400">ADMIN ACCESS</h2>
                <p class="text-gray-300 mb-6">Masukkan kode admin untuk melewati tutorial:</p>
                <input type="password" id="adminCode" placeholder="Kode Admin..." 
                       class="w-full px-4 py-3 bg-gray-800 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-red-400 focus:outline-none mb-4">
                <div class="flex space-x-4">
                    <button onclick="checkAdminCode()" class="flex-1 bg-gradient-to-r from-red-600 to-red-700 px-6 py-3 rounded-lg font-bold hover:from-red-500 hover:to-red-600 transition-all">
                        MASUK
                    </button>
                    <button onclick="closeAdminAccess()" class="flex-1 bg-gradient-to-r from-gray-600 to-gray-700 px-6 py-3 rounded-lg font-bold hover:from-gray-500 hover:to-gray-600 transition-all">
                        BATAL
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-4">Hint: Nama kerajaan + tahun ajaran (contoh: thirdia2024)</p>
            </div>
        </div>

        <!-- Character Creation Page -->
        <div id="characterCreation" class="min-h-screen flex items-center justify-center px-2 sm:px-4">
            <div class="bg-gradient-to-br from-purple-900/80 to-blue-900/80 p-4 sm:p-6 md:p-8 rounded-2xl border-2 border-purple-400 backdrop-blur-lg max-w-md w-full mx-2 sm:mx-4">
                <div class="text-center mb-6 sm:mb-8">
                    <h1 class="game-title text-2xl sm:text-3xl md:text-4xl font-bold mb-3 sm:mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">
                        THIRDIA CHRONICLES
                    </h1>
                    <p class="text-lg sm:text-xl text-gray-300 mb-2">Buat Karakter Anda</p>
                    <div class="w-20 sm:w-24 h-1 bg-gradient-to-r from-purple-500 to-blue-500 mx-auto rounded-full"></div>
                </div>
                
                <form id="characterForm" class="space-y-4 sm:space-y-6">
                    <!-- Name Input -->
                    <div>
                        <label class="block text-base sm:text-lg font-semibold mb-2 sm:mb-3 text-yellow-400">
                            🏷️ Nama Karakter
                        </label>
                        <input 
                            type="text" 
                            id="characterName" 
                            required
                            placeholder="Masukkan nama petualang Anda..."
                            class="w-full px-3 sm:px-4 py-2 sm:py-3 bg-gray-800/70 border-2 border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-purple-400 focus:outline-none focus:ring-2 focus:ring-purple-400/50 transition-all text-sm sm:text-base"
                        >
                    </div>
                    
                    <!-- Gender Selection -->
                    <div>
                        <label class="block text-base sm:text-lg font-semibold mb-2 sm:mb-3 text-yellow-400">
                            ⚧️ Jenis Kelamin
                        </label>
                        <div class="grid grid-cols-2 gap-3 sm:gap-4">
                            <label class="gender-option cursor-pointer">
                                <input type="radio" name="gender" value="Pria" class="hidden" required>
                                <div class="gender-card bg-gray-800/70 border-2 border-gray-600 rounded-lg p-3 sm:p-4 text-center transition-all hover:border-blue-400">
                                    <div class="text-2xl sm:text-4xl mb-1 sm:mb-2">👨‍⚔️</div>
                                    <span class="font-semibold text-sm sm:text-base">Pria</span>
                                </div>
                            </label>
                            <label class="gender-option cursor-pointer">
                                <input type="radio" name="gender" value="Wanita" class="hidden" required>
                                <div class="gender-card bg-gray-800/70 border-2 border-gray-600 rounded-lg p-3 sm:p-4 text-center transition-all hover:border-pink-400">
                                    <div class="text-2xl sm:text-4xl mb-1 sm:mb-2">👩‍⚔️</div>
                                    <span class="font-semibold text-sm sm:text-base">Wanita</span>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Continue Button -->
                    <button 
                        type="submit" 
                        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 px-4 sm:px-6 py-3 sm:py-4 rounded-lg text-lg sm:text-xl font-bold text-white transition-all transform hover:scale-105 shadow-lg"
                    >
                        🚀 LANJUT KE PEMILIHAN ROLE
                    </button>
                    
                    <!-- Hidden Admin Access Trigger -->
                    <div class="text-center mt-4">
                        <button type="button" onclick="showAdminAccess()" class="text-xs text-gray-500 hover:text-gray-400 transition-all opacity-30 hover:opacity-60">
                            Admin Access
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Role Selection Page (Initially Hidden) -->
        <div id="roleSelection" class="hidden">
            <!-- Header -->
            <div class="text-center mb-8 sm:mb-12 px-2 sm:px-4">
                <h1 class="game-title text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-3 sm:mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">
                    THIRDIA CHRONICLES
                </h1>
                <div id="playerInfo" class="text-base sm:text-lg md:text-xl text-gray-300 mb-3 sm:mb-4"></div>
                <p class="text-sm sm:text-base md:text-lg text-gray-400 mb-2">Pilih Role Petualangan Anda</p>
                <div class="w-24 sm:w-28 md:w-32 h-1 bg-gradient-to-r from-purple-500 to-blue-500 mx-auto rounded-full"></div>
            </div>
            
            <!-- Role Selection Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 md:gap-8 mb-8 sm:mb-12 px-2 sm:px-4">
            <!-- Kesatria -->
            <div class="role-card p-4 sm:p-6 md:p-8 rounded-2xl cursor-pointer text-center" onclick="selectRole(this, 'Kesatria')">
                <div class="hexagon">
                    <div class="role-icon absolute inset-0 flex items-center justify-center">
                        <svg viewBox="0 0 120 120" class="w-16 sm:w-18 md:w-20 h-16 sm:h-18 md:h-20">
                            <!-- Knight Character -->
                            <!-- Head -->
                            <circle cx="60" cy="30" r="12" fill="#fdbcbc" stroke="#d4a574" stroke-width="1"/>
                            <!-- Helmet -->
                            <path d="M48 25 Q60 15 72 25 L72 35 Q60 40 48 35 Z" fill="#c0c0c0" stroke="#a0a0a0" stroke-width="1"/>
                            <rect x="58" y="20" width="4" height="8" fill="#ffd700"/>
                            <!-- Body Armor -->
                            <rect x="50" y="42" width="20" height="35" fill="#4a90e2" rx="3" stroke="#2c5aa0" stroke-width="2"/>
                            <!-- Chest Plate -->
                            <rect x="52" y="45" width="16" height="25" fill="#e6e6e6" rx="2" stroke="#c0c0c0" stroke-width="1"/>
                            <circle cx="60" cy="52" r="3" fill="#ffd700"/>
                            <!-- Arms -->
                            <rect x="42" y="45" width="8" height="20" fill="#4a90e2" rx="4"/>
                            <rect x="70" y="45" width="8" height="20" fill="#4a90e2" rx="4"/>
                            <!-- Shield -->
                            <ellipse cx="35" cy="55" rx="8" ry="12" fill="#e6e6e6" stroke="#c0c0c0" stroke-width="2"/>
                            <path d="M35 47 L35 63 M29 55 L41 55" stroke="#ffd700" stroke-width="2"/>
                            <!-- Sword -->
                            <rect x="82" y="40" width="3" height="25" fill="#c0c0c0"/>
                            <rect x="80" y="38" width="7" height="4" fill="#8b4513"/>
                            <!-- Legs -->
                            <rect x="54" y="77" width="6" height="25" fill="#4a90e2"/>
                            <rect x="60" y="77" width="6" height="25" fill="#4a90e2"/>
                            <!-- Boots -->
                            <rect x="52" y="100" width="10" height="6" fill="#654321" rx="3"/>
                            <rect x="58" y="100" width="10" height="6" fill="#654321" rx="3"/>
                            <!-- Cape -->
                            <path d="M50 42 Q45 50 48 65 Q52 70 60 68 Q68 70 72 65 Q75 50 70 42" fill="#8b0000" opacity="0.8"/>
                        </svg>
                    </div>
                </div>
                <h3 class="text-lg sm:text-xl md:text-2xl font-bold mb-2 sm:mb-3 role-title">KESATRIA</h3>
                <p class="text-xs sm:text-sm text-gray-300 mb-3 sm:mb-4 leading-relaxed">Pejuang tangguh dengan pedang dan perisai. Seimbang dalam serangan dan pertahanan.</p>
                <div class="space-y-2 sm:space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-red-400">ATTACK</span>
                        <div class="stats-bar w-16 sm:w-20">
                            <div class="stats-fill" style="width: 80%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-blue-400">DEFENSE</span>
                        <div class="stats-bar w-16 sm:w-20">
                            <div class="stats-fill" style="width: 80%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-purple-400">MAGIC</span>
                        <div class="stats-bar w-16 sm:w-20">
                            <div class="stats-fill" style="width: 40%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Penyihir -->
            <div class="role-card p-4 sm:p-6 md:p-8 rounded-2xl cursor-pointer text-center" onclick="selectRole(this, 'Penyihir')">
                <div class="hexagon">
                    <div class="role-icon absolute inset-0 flex items-center justify-center">
                        <svg viewBox="0 0 120 120" class="w-16 sm:w-18 md:w-20 h-16 sm:h-18 md:h-20">
                            <!-- Wizard Character -->
                            <!-- Head -->
                            <circle cx="60" cy="32" r="10" fill="#fdbcbc" stroke="#d4a574" stroke-width="1"/>
                            <!-- Beard -->
                            <path d="M52 38 Q60 45 68 38 Q65 48 60 50 Q55 48 52 38" fill="#e6e6e6"/>
                            <!-- Wizard Hat -->
                            <path d="M50 25 Q60 8 70 25 Q68 30 60 32 Q52 30 50 25" fill="#4a148c" stroke="#6a1b9a" stroke-width="1"/>
                            <circle cx="65" cy="15" r="3" fill="#ffd700"/>
                            <!-- Stars on hat -->
                            <polygon points="55,20 56,22 58,22 56.5,23.5 57,25.5 55,24 53,25.5 53.5,23.5 52,22 54,22" fill="#ffd700"/>
                            <!-- Robe -->
                            <path d="M48 42 Q60 40 72 42 L75 85 Q60 88 45 85 Z" fill="#673ab7" stroke="#512da8" stroke-width="2"/>
                            <!-- Robe Details -->
                            <path d="M52 50 Q60 48 68 50 Q65 60 60 62 Q55 60 52 50" fill="#9c27b0" opacity="0.7"/>
                            <!-- Arms -->
                            <ellipse cx="42" cy="55" rx="6" ry="15" fill="#673ab7"/>
                            <ellipse cx="78" cy="55" rx="6" ry="15" fill="#673ab7"/>
                            <!-- Magic Staff -->
                            <rect x="85" y="35" width="3" height="40" fill="#8d6e63"/>
                            <circle cx="86.5" cy="32" r="5" fill="#3f51b5"/>
                            <circle cx="86.5" cy="32" r="3" fill="#e3f2fd"/>
                            <!-- Magic Orb in hand -->
                            <circle cx="38" cy="50" r="4" fill="#2196f3" opacity="0.8"/>
                            <circle cx="38" cy="50" r="2" fill="#e3f2fd"/>
                            <!-- Legs -->
                            <rect x="54" y="85" width="5" height="20" fill="#673ab7"/>
                            <rect x="61" y="85" width="5" height="20" fill="#673ab7"/>
                            <!-- Shoes -->
                            <ellipse cx="56.5" cy="107" rx="4" ry="2" fill="#424242"/>
                            <ellipse cx="63.5" cy="107" rx="4" ry="2" fill="#424242"/>
                            <!-- Magic Sparkles -->
                            <circle cx="25" cy="40" r="1.5" fill="#ffd700" opacity="0.8"/>
                            <circle cx="95" cy="50" r="1" fill="#00bcd4" opacity="0.8"/>
                            <circle cx="30" cy="65" r="1" fill="#e91e63" opacity="0.8"/>
                            <circle cx="90" cy="70" r="1.5" fill="#4caf50" opacity="0.8"/>
                        </svg>
                    </div>
                </div>
                <h3 class="text-lg sm:text-xl md:text-2xl font-bold mb-2 sm:mb-3 role-title">PENYIHIR</h3>
                <p class="text-xs sm:text-sm text-gray-300 mb-3 sm:mb-4 leading-relaxed">Master sihir dengan kekuatan elemental. Serangan jarak jauh yang dahsyat.</p>
                <div class="space-y-2 sm:space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-red-400">ATTACK</span>
                        <div class="stats-bar w-16 sm:w-20">
                            <div class="stats-fill" style="width: 60%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-blue-400">DEFENSE</span>
                        <div class="stats-bar w-16 sm:w-20">
                            <div class="stats-fill" style="width: 40%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-purple-400">MAGIC</span>
                        <div class="stats-bar w-16 sm:w-20">
                            <div class="stats-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pemanah -->
            <div class="role-card p-4 sm:p-6 md:p-8 rounded-2xl cursor-pointer text-center" onclick="selectRole(this, 'Pemanah')">
                <div class="hexagon">
                    <div class="role-icon absolute inset-0 flex items-center justify-center">
                        <svg viewBox="0 0 120 120" class="w-16 sm:w-18 md:w-20 h-16 sm:h-18 md:h-20">
                            <!-- Archer Character -->
                            <!-- Head -->
                            <circle cx="60" cy="28" r="10" fill="#fdbcbc" stroke="#d4a574" stroke-width="1"/>
                            <!-- Hair -->
                            <path d="M50 22 Q60 18 70 22 Q68 28 60 30 Q52 28 50 22" fill="#8d6e63"/>
                            <!-- Hood -->
                            <path d="M48 20 Q60 12 72 20 Q70 32 60 35 Q50 32 48 20" fill="#2e7d32" opacity="0.8"/>
                            <!-- Body -->
                            <rect x="52" y="38" width="16" height="30" fill="#388e3c" rx="3" stroke="#2e7d32" stroke-width="1"/>
                            <!-- Leather Vest -->
                            <rect x="54" y="42" width="12" height="22" fill="#5d4037" rx="2"/>
                            <rect x="56" y="45" width="8" height="3" fill="#8d6e63"/>
                            <rect x="56" y="50" width="8" height="3" fill="#8d6e63"/>
                            <rect x="56" y="55" width="8" height="3" fill="#8d6e63"/>
                            <!-- Arms -->
                            <ellipse cx="45" cy="50" rx="5" ry="12" fill="#388e3c"/>
                            <ellipse cx="75" cy="50" rx="5" ry="12" fill="#388e3c"/>
                            <!-- Bow -->
                            <path d="M25 35 Q20 50 25 65" stroke="#8d6e63" stroke-width="3" fill="none"/>
                            <path d="M25 35 Q35 50 25 65" stroke="#654321" stroke-width="1" fill="none"/>
                            <!-- Bowstring -->
                            <line x1="25" y1="38" x2="25" y2="62" stroke="#424242" stroke-width="1"/>
                            <!-- Arrow -->
                            <line x1="25" y1="50" x2="40" y2="50" stroke="#8d6e63" stroke-width="2"/>
                            <polygon points="18,50 25,48 25,52" fill="#616161"/>
                            <polygon points="40,50 44,48 44,52" fill="#f44336"/>
                            <!-- Quiver -->
                            <rect x="75" y="40" width="8" height="20" fill="#5d4037" rx="4"/>
                            <rect x="76" y="38" width="2" height="8" fill="#8d6e63"/>
                            <rect x="79" y="36" width="2" height="10" fill="#8d6e63"/>
                            <rect x="82" y="38" width="2" height="8" fill="#8d6e63"/>
                            <!-- Legs -->
                            <rect x="55" y="68" width="5" height="22" fill="#388e3c"/>
                            <rect x="60" y="68" width="5" height="22" fill="#388e3c"/>
                            <!-- Boots -->
                            <ellipse cx="57.5" cy="92" rx="4" ry="3" fill="#5d4037"/>
                            <ellipse cx="62.5" cy="92" rx="4" ry="3" fill="#5d4037"/>
                            <!-- Cape -->
                            <path d="M52 38 Q45 45 48 60 Q52 65 60 63 Q68 65 72 60 Q75 45 68 38" fill="#1b5e20" opacity="0.6"/>
                            <!-- Belt -->
                            <rect x="52" y="62" width="16" height="3" fill="#8d6e63"/>
                            <rect x="58" y="61" width="4" height="5" fill="#ffd700"/>
                        </svg>
                    </div>
                </div>
                <h3 class="text-2xl font-bold mb-3 role-title">PEMANAH</h3>
                <p class="text-sm text-gray-300 mb-4 leading-relaxed">Ahli serangan jarak jauh dengan busur. Cepat dan akurat dalam pertempuran.</p>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-red-400">ATTACK</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 80%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-blue-400">DEFENSE</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 50%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-green-400">AGILITY</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tank -->
            <div class="role-card p-8 rounded-2xl cursor-pointer text-center" onclick="selectRole(this, 'Tank')">
                <div class="hexagon">
                    <div class="role-icon absolute inset-0 flex items-center justify-center">
                        <svg viewBox="0 0 120 120" class="w-20 h-20">
                            <!-- Tank Character -->
                            <!-- Head -->
                            <circle cx="60" cy="25" r="8" fill="#fdbcbc" stroke="#d4a574" stroke-width="1"/>
                            <!-- Full Helmet -->
                            <path d="M52 20 Q60 12 68 20 L68 32 Q60 35 52 32 Z" fill="#9e9e9e" stroke="#757575" stroke-width="2"/>
                            <!-- Helmet Visor -->
                            <rect x="55" y="22" width="10" height="6" fill="#424242" rx="1"/>
                            <!-- Plume -->
                            <rect x="58" y="12" width="4" height="8" fill="#f44336"/>
                            <!-- Massive Body Armor -->
                            <rect x="45" y="35" width="30" height="40" fill="#607d8b" rx="5" stroke="#455a64" stroke-width="3"/>
                            <!-- Chest Plate Detail -->
                            <rect x="50" y="40" width="20" height="25" fill="#cfd8dc" rx="3" stroke="#90a4ae" stroke-width="2"/>
                            <circle cx="60" cy="47" r="4" fill="#ffd700" stroke="#ff8f00" stroke-width="1"/>
                            <rect x="57" y="52" width="6" height="8" fill="#f44336"/>
                            <!-- Shoulder Armor -->
                            <ellipse cx="35" cy="42" rx="12" ry="8" fill="#78909c" stroke="#546e7a" stroke-width="2"/>
                            <ellipse cx="85" cy="42" rx="12" ry="8" fill="#78909c" stroke="#546e7a" stroke-width="2"/>
                            <!-- Arms -->
                            <rect x="25" y="45" width="10" height="20" fill="#607d8b" rx="5"/>
                            <rect x="85" y="45" width="10" height="20" fill="#607d8b" rx="5"/>
                            <!-- Massive Shield -->
                            <ellipse cx="15" cy="55" rx="12" ry="18" fill="#cfd8dc" stroke="#90a4ae" stroke-width="3"/>
                            <path d="M15 40 L15 70 M5 55 L25 55" stroke="#ffd700" stroke-width="3"/>
                            <circle cx="15" cy="55" r="5" fill="#f44336"/>
                            <!-- War Hammer -->
                            <rect x="100" y="35" width="4" height="30" fill="#8d6e63"/>
                            <rect x="95" y="32" width="14" height="8" fill="#9e9e9e" stroke="#757575" stroke-width="1"/>
                            <rect x="97" y="30" width="10" height="4" fill="#424242"/>
                            <!-- Legs -->
                            <rect x="52" y="75" width="8" height="25" fill="#607d8b"/>
                            <rect x="60" y="75" width="8" height="25" fill="#607d8b"/>
                            <!-- Heavy Boots -->
                            <rect x="48" y="98" width="14" height="8" fill="#424242" rx="4"/>
                            <rect x="58" y="98" width="14" height="8" fill="#424242" rx="4"/>
                            <!-- Leg Armor -->
                            <rect x="50" y="78" width="12" height="15" fill="#78909c" rx="2"/>
                            <rect x="52" y="80" width="8" height="3" fill="#9e9e9e"/>
                            <rect x="52" y="85" width="8" height="3" fill="#9e9e9e"/>
                            <!-- Belt -->
                            <rect x="45" y="70" width="30" height="5" fill="#8d6e63"/>
                            <rect x="57" y="68" width="6" height="9" fill="#ffd700"/>
                        </svg>
                    </div>
                </div>
                <h3 class="text-2xl font-bold mb-3 role-title">TANK</h3>
                <p class="text-sm text-gray-300 mb-4 leading-relaxed">Pelindung tim dengan armor tebal. Menarik perhatian musuh dan melindungi sekutu.</p>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-red-400">ATTACK</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 50%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-blue-400">DEFENSE</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-emerald-400">HEALTH</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Penyembuh -->
            <div class="role-card p-8 rounded-2xl cursor-pointer text-center" onclick="selectRole(this, 'Penyembuh')">
                <div class="hexagon">
                    <div class="role-icon absolute inset-0 flex items-center justify-center">
                        <svg viewBox="0 0 120 120" class="w-20 h-20">
                            <!-- Healer Character -->
                            <!-- Head -->
                            <circle cx="60" cy="28" r="10" fill="#fdbcbc" stroke="#d4a574" stroke-width="1"/>
                            <!-- Hair -->
                            <path d="M50 22 Q60 15 70 22 Q68 30 60 32 Q52 30 50 22" fill="#ffb74d"/>
                            <!-- Halo -->
                            <circle cx="60" cy="18" r="8" fill="none" stroke="#ffd700" stroke-width="2" opacity="0.8"/>
                            <!-- White Robe -->
                            <path d="M48 38 Q60 36 72 38 L75 85 Q60 88 45 85 Z" fill="#f5f5f5" stroke="#e0e0e0" stroke-width="2"/>
                            <!-- Robe Details -->
                            <path d="M52 45 Q60 43 68 45 Q65 55 60 57 Q55 55 52 45" fill="#e8f5e9" opacity="0.8"/>
                            <rect x="57" y="50" width="6" height="2" fill="#4caf50"/>
                            <rect x="59" y="48" width="2" height="6" fill="#4caf50"/>
                            <!-- Arms -->
                            <ellipse cx="42" cy="52" rx="6" ry="15" fill="#f5f5f5"/>
                            <ellipse cx="78" cy="52" rx="6" ry="15" fill="#f5f5f5"/>
                            <!-- Healing Staff -->
                            <rect x="85" y="30" width="3" height="45" fill="#8d6e63"/>
                            <!-- Staff Top -->
                            <circle cx="86.5" cy="27" r="6" fill="none" stroke="#ffd700" stroke-width="2"/>
                            <rect x="84.5" y="25" width="4" height="2" fill="#4caf50"/>
                            <rect x="85.5" y="24" width="2" height="4" fill="#4caf50"/>
                            <!-- Holy Book -->
                            <rect x="32" y="48" width="8" height="10" fill="#795548" rx="1"/>
                            <rect x="33" y="49" width="6" height="8" fill="#f5f5f5" rx="1"/>
                            <line x1="34" y1="51" x2="38" y2="51" stroke="#4caf50" stroke-width="1"/>
                            <line x1="34" y1="53" x2="38" y2="53" stroke="#4caf50" stroke-width="1"/>
                            <line x1="34" y1="55" x2="38" y2="55" stroke="#4caf50" stroke-width="1"/>
                            <!-- Legs -->
                            <rect x="54" y="85" width="5" height="20" fill="#f5f5f5"/>
                            <rect x="61" y="85" width="5" height="20" fill="#f5f5f5"/>
                            <!-- Sandals -->
                            <ellipse cx="56.5" cy="107" rx="4" ry="2" fill="#8d6e63"/>
                            <ellipse cx="63.5" cy="107" rx="4" ry="2" fill="#8d6e63"/>
                            <!-- Belt with Cross -->
                            <rect x="48" y="75" width="24" height="4" fill="#8d6e63"/>
                            <rect x="58" y="73" width="4" height="2" fill="#ffd700"/>
                            <rect x="59" y="72" width="2" height="4" fill="#ffd700"/>
                            <!-- Healing Aura -->
                            <circle cx="25" cy="35" r="2" fill="#4caf50" opacity="0.6"/>
                            <circle cx="95" cy="45" r="1.5" fill="#81c784" opacity="0.6"/>
                            <circle cx="30" cy="60" r="1" fill="#a5d6a7" opacity="0.6"/>
                            <circle cx="90" cy="65" r="2" fill="#4caf50" opacity="0.6"/>
                            <circle cx="20" cy="70" r="1.5" fill="#81c784" opacity="0.6"/>
                            <!-- Cross Symbol on Chest -->
                            <rect x="58" y="42" width="4" height="2" fill="#4caf50"/>
                            <rect x="59" y="41" width="2" height="4" fill="#4caf50"/>
                        </svg>
                    </div>
                </div>
                <h3 class="text-2xl font-bold mb-3 role-title">PENYEMBUH</h3>
                <p class="text-sm text-gray-300 mb-4 leading-relaxed">Support tim dengan kemampuan healing. Menjaga tim tetap hidup dalam pertempuran.</p>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-red-400">ATTACK</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 30%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-emerald-400">HEALING</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-purple-400">MAGIC</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 80%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Kesatria Hitam -->
            <div class="role-card p-8 rounded-2xl cursor-pointer text-center" onclick="selectRole(this, 'Kesatria Hitam')">
                <div class="hexagon">
                    <div class="role-icon absolute inset-0 flex items-center justify-center">
                        <svg viewBox="0 0 120 120" class="w-20 h-20">
                            <!-- Dark Knight Character -->
                            <!-- Head -->
                            <circle cx="60" cy="25" r="8" fill="#fdbcbc" stroke="#d4a574" stroke-width="1"/>
                            <!-- Dark Helmet -->
                            <path d="M50 20 Q60 10 70 20 L70 35 Q60 38 50 35 Z" fill="#212121" stroke="#000000" stroke-width="2"/>
                            <!-- Helmet Horns -->
                            <polygon points="52,18 50,10 54,12" fill="#424242"/>
                            <polygon points="68,18 70,10 66,12" fill="#424242"/>
                            <!-- Red Eyes -->
                            <circle cx="56" cy="25" r="2" fill="#f44336"/>
                            <circle cx="64" cy="25" r="2" fill="#f44336"/>
                            <!-- Dark Armor -->
                            <rect x="48" y="38" width="24" height="35" fill="#424242" rx="4" stroke="#212121" stroke-width="2"/>
                            <!-- Chest Plate -->
                            <rect x="52" y="42" width="16" height="25" fill="#616161" rx="2" stroke="#424242" stroke-width="1"/>
                            <!-- Dark Symbol -->
                            <polygon points="60,48 58,52 62,52" fill="#f44336"/>
                            <rect x="59" y="52" width="2" height="8" fill="#f44336"/>
                            <!-- Shoulder Spikes -->
                            <polygon points="45,40 40,35 48,42" fill="#616161"/>
                            <polygon points="75,40 80,35 72,42" fill="#616161"/>
                            <!-- Arms -->
                            <rect x="38" y="45" width="10" height="22" fill="#424242" rx="5"/>
                            <rect x="72" y="45" width="10" height="22" fill="#424242" rx="5"/>
                            <!-- Dark Sword -->
                            <rect x="85" y="25" width="4" height="35" fill="#212121"/>
                            <rect x="83" y="22" width="8" height="6" fill="#424242"/>
                            <rect x="85" y="20" width="4" height="4" fill="#f44336"/>
                            <!-- Dark Flames -->
                            <path d="M87 60 Q85 65 89 68 Q91 65 87 60" fill="#f44336" opacity="0.7"/>
                            <path d="M85 62 Q83 67 87 70 Q89 67 85 62" fill="#ff5722" opacity="0.7"/>
                            <!-- Dark Shield -->
                            <ellipse cx="25" cy="55" rx="10" ry="15" fill="#212121" stroke="#000000" stroke-width="2"/>
                            <polygon points="25,45 23,50 27,50" fill="#f44336"/>
                            <rect x="24" y="50" width="2" height="10" fill="#f44336"/>
                            <!-- Legs -->
                            <rect x="52" y="73" width="7" height="25" fill="#424242"/>
                            <rect x="61" y="73" width="7" height="25" fill="#424242"/>
                            <!-- Dark Boots -->
                            <rect x="49" y="96" width="12" height="8" fill="#212121" rx="4"/>
                            <rect x="59" y="96" width="12" height="8" fill="#212121" rx="4"/>
                            <!-- Leg Armor -->
                            <rect x="50" y="76" width="9" height="12" fill="#616161" rx="2"/>
                            <rect x="61" y="76" width="9" height="12" fill="#616161" rx="2"/>
                            <!-- Dark Cape -->
                            <path d="M48 38 Q40 45 42 65 Q48 70 60 68 Q72 70 78 65 Q80 45 72 38" fill="#b71c1c" opacity="0.8"/>
                            <!-- Dark Aura -->
                            <circle cx="20" cy="30" r="2" fill="#f44336" opacity="0.5"/>
                            <circle cx="100" cy="40" r="1.5" fill="#d32f2f" opacity="0.5"/>
                            <circle cx="15" cy="70" r="1" fill="#b71c1c" opacity="0.5"/>
                            <circle cx="105" cy="75" r="2" fill="#f44336" opacity="0.5"/>
                        </svg>
                    </div>
                </div>
                <h3 class="text-2xl font-bold mb-3 role-title">KESATRIA HITAM</h3>
                <p class="text-sm text-gray-300 mb-4 leading-relaxed">Pejuang gelap dengan kekuatan jahat. Serangan kuat dengan kemampuan dark magic.</p>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-red-400">ATTACK</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-blue-400">DEFENSE</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 70%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-red-500">DARK MAGIC</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 90%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Penyihir Hitam -->
            <div class="role-card p-8 rounded-2xl cursor-pointer text-center" onclick="selectRole(this, 'Penyihir Hitam')">
                <div class="hexagon">
                    <div class="role-icon absolute inset-0 flex items-center justify-center">
                        <svg viewBox="0 0 120 120" class="w-20 h-20">
                            <!-- Dark Wizard Character -->
                            <!-- Head -->
                            <circle cx="60" cy="32" r="10" fill="#fdbcbc" stroke="#d4a574" stroke-width="1"/>
                            <!-- Dark Beard -->
                            <path d="M52 38 Q60 45 68 38 Q65 48 60 50 Q55 48 52 38" fill="#424242"/>
                            <!-- Dark Wizard Hat -->
                            <path d="M50 25 Q60 5 70 25 Q68 30 60 32 Q52 30 50 25" fill="#212121" stroke="#000000" stroke-width="2"/>
                            <!-- Skull on Hat -->
                            <circle cx="65" cy="15" r="3" fill="#e0e0e0"/>
                            <circle cx="63.5" cy="14" r="0.5" fill="#000000"/>
                            <circle cx="66.5" cy="14" r="0.5" fill="#000000"/>
                            <path d="M63 16 Q65 17 67 16" stroke="#000000" stroke-width="0.5" fill="none"/>
                            <!-- Dark Symbols on Hat -->
                            <polygon points="55,20 56,22 58,22 56.5,23.5 57,25.5 55,24 53,25.5 53.5,23.5 52,22 54,22" fill="#f44336"/>
                            <!-- Dark Robe -->
                            <path d="M48 42 Q60 40 72 42 L75 85 Q60 88 45 85 Z" fill="#212121" stroke="#000000" stroke-width="2"/>
                            <!-- Robe Details -->
                            <path d="M52 50 Q60 48 68 50 Q65 60 60 62 Q55 60 52 50" fill="#424242" opacity="0.8"/>
                            <!-- Dark Symbols on Robe -->
                            <circle cx="60" cy="55" r="2" fill="#f44336"/>
                            <polygon points="60,52 58,54 62,54" fill="#f44336"/>
                            <!-- Arms -->
                            <ellipse cx="42" cy="55" rx="6" ry="15" fill="#212121"/>
                            <ellipse cx="78" cy="55" rx="6" ry="15" fill="#212121"/>
                            <!-- Dark Magic Staff -->
                            <rect x="85" y="35" width="3" height="40" fill="#424242"/>
                            <!-- Staff Top - Dark Crystal -->
                            <polygon points="86.5,30 84,35 89,35" fill="#9c27b0"/>
                            <circle cx="86.5" cy="32" r="3" fill="#4a148c" opacity="0.8"/>
                            <!-- Dark Orb in Hand -->
                            <circle cx="38" cy="50" r="4" fill="#9c27b0" opacity="0.9"/>
                            <circle cx="38" cy="50" r="2" fill="#212121"/>
                            <!-- Legs -->
                            <rect x="54" y="85" width="5" height="20" fill="#212121"/>
                            <rect x="61" y="85" width="5" height="20" fill="#212121"/>
                            <!-- Dark Shoes -->
                            <ellipse cx="56.5" cy="107" rx="4" ry="2" fill="#000000"/>
                            <ellipse cx="63.5" cy="107" rx="4" ry="2" fill="#000000"/>
                            <!-- Dark Magic Effects -->
                            <circle cx="25" cy="40" r="1.5" fill="#f44336" opacity="0.8"/>
                            <circle cx="95" cy="50" r="1" fill="#9c27b0" opacity="0.8"/>
                            <circle cx="30" cy="65" r="1" fill="#d32f2f" opacity="0.8"/>
                            <circle cx="90" cy="70" r="1.5" fill="#7b1fa2" opacity="0.8"/>
                            <circle cx="20" cy="75" r="1" fill="#f44336" opacity="0.8"/>
                            <!-- Dark Lightning -->
                            <path d="M15 35 L20 40 L18 42 L25 48" stroke="#9c27b0" stroke-width="2" fill="none" opacity="0.7"/>
                            <path d="M95 45 L100 50 L98 52 L105 58" stroke="#f44336" stroke-width="2" fill="none" opacity="0.7"/>
                            <!-- Glowing Red Eyes -->
                            <circle cx="56" cy="28" r="1" fill="#f44336"/>
                            <circle cx="64" cy="28" r="1" fill="#f44336"/>
                        </svg>
                    </div>
                </div>
                <h3 class="text-2xl font-bold mb-3 role-title">PENYIHIR HITAM</h3>
                <p class="text-sm text-gray-300 mb-4 leading-relaxed">Master sihir gelap dengan kekuatan destruktif. Menguasai curse dan dark magic.</p>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-red-400">ATTACK</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 70%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-red-500">DARK MAGIC</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-semibold text-purple-600">CURSE</span>
                        <div class="stats-bar w-20">
                            <div class="stats-fill" style="width: 90%"></div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            
            <!-- Selected Role Display -->
            <div id="selectedRole" class="text-center mb-6 sm:mb-8 hidden px-2 sm:px-4">
            <div class="bg-gradient-to-r from-purple-800 to-blue-800 p-4 sm:p-6 rounded-xl border-2 border-yellow-400">
                <h3 class="text-lg sm:text-xl md:text-2xl font-bold mb-2">Role Terpilih:</h3>
                <p id="selectedRoleName" class="text-xl sm:text-2xl md:text-3xl font-bold text-yellow-400"></p>
                <p class="text-sm sm:text-base text-gray-300 mt-2">Siap memulai petualangan di Thirdia Chronicles?</p>
            </div>
            </div>
            
            <!-- Confirm Button -->
            <div class="text-center px-2 sm:px-4">
                <button id="confirmBtn" class="confirm-btn px-8 sm:px-10 md:px-12 py-3 sm:py-4 rounded-xl text-lg sm:text-xl font-bold text-white shadow-lg hidden w-full sm:w-auto" onclick="confirmSelection()">
                    🚀 MULAI PETUALANGAN
                </button>
            </div>
        </div>
        
        <!-- Success Modal -->
        <div id="successModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50 p-2 sm:p-4">
            <div class="bg-gradient-to-br from-purple-900 to-blue-900 p-4 sm:p-6 md:p-8 rounded-2xl border-2 border-yellow-400 text-center max-w-lg w-full mx-2 sm:mx-4">
                <div class="text-4xl sm:text-5xl md:text-6xl mb-3 sm:mb-4">⚔️</div>
                <h2 class="text-xl sm:text-2xl md:text-3xl font-bold mb-3 sm:mb-4 text-yellow-400">Selamat Datang, Petualang!</h2>
                
                <!-- Role Image in Hexagon Frame -->
                <div class="hexagon-modal mb-4 sm:mb-6">
                    <div id="modalRoleIcon" class="absolute inset-0 flex items-center justify-center">
                        <!-- Role icon will be inserted here -->
                    </div>
                </div>
                
                <p class="text-sm sm:text-base md:text-lg mb-2">Anda telah memilih role:</p>
                <p id="finalRole" class="text-lg sm:text-xl md:text-2xl font-bold text-green-400 mb-4 sm:mb-6"></p>
                <p class="text-sm sm:text-base text-gray-300 mb-4 sm:mb-6">Petualangan epik di Thirdia Chronicles menanti Anda!</p>
                <button onclick="saveAsImageAndClose()" class="bg-gradient-to-r from-green-600 to-emerald-600 px-6 sm:px-8 py-2 sm:py-3 rounded-lg font-bold hover:from-green-500 hover:to-emerald-500 transition-all text-sm sm:text-base">
                    Siap Bertualang! 🎮
                </button>
            </div>
        </div>
        
        <!-- Platformer Game Page -->
        <div id="platformerGame" class="hidden min-h-screen relative overflow-hidden bg-gradient-to-b from-green-400 via-green-500 to-green-800">
            <!-- Game Canvas -->
            <canvas id="gameCanvas" class="absolute inset-0 w-full h-full"></canvas>
            
            <!-- Game UI -->
            <div class="absolute top-2 sm:top-4 left-2 sm:left-4 bg-black bg-opacity-70 p-2 sm:p-3 md:p-4 rounded-lg border-2 border-yellow-400 z-10">
                <div class="text-yellow-400 font-bold text-xs sm:text-sm md:text-lg" id="platformerPlayerInfo">
                    <!-- Player info will be inserted here -->
                </div>
                <div class="text-red-400 font-semibold text-xs sm:text-sm mt-1 sm:mt-2" id="livesDisplay">
                    ❤️ Nyawa: <span id="livesCounter">5</span>/5
                </div>
                <div class="text-blue-400 font-semibold text-xs sm:text-sm mt-1" id="scoreDisplay">
                    🏆 Skor: <span id="scoreCounter">0</span>
                </div>
            </div>
            
            <!-- Mobile Controls -->
            <div class="absolute bottom-4 left-4 flex space-x-4 z-10">
                <!-- Movement Controls -->
                <div class="bg-gray-800 bg-opacity-90 p-3 rounded-2xl border-2 border-gray-600 shadow-2xl">
                    <div class="flex items-center space-x-4">
                        <!-- Left Button -->
                        <button id="leftBtn" 
                                class="w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg transition-all active:scale-95 shadow-lg">
                            ←
                        </button>
                        
                        <!-- Right Button -->
                        <button id="rightBtn" 
                                class="w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg transition-all active:scale-95 shadow-lg">
                            →
                        </button>
                    </div>
                    <div class="flex justify-center mt-2 text-gray-400 text-xs font-semibold">
                        GERAK
                    </div>
                </div>
            </div>
            
            <!-- Jump Button -->
            <div class="absolute bottom-4 right-4 z-10">
                <div class="bg-gray-800 bg-opacity-90 p-3 rounded-2xl border-2 border-gray-600 shadow-2xl">
                    <button id="jumpBtn" 
                            class="w-16 h-16 sm:w-18 sm:h-18 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 rounded-full flex items-center justify-center text-white font-bold text-2xl transition-all active:scale-95 shadow-lg">
                        ⬆️
                    </button>
                    <div class="text-center mt-2 text-gray-400 text-xs font-semibold">
                        LOMPAT
                    </div>
                </div>
            </div>
            
            <!-- Game Over Modal -->
            <div id="gameOverModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50 p-4">
                <div class="bg-gradient-to-br from-red-900 to-gray-900 p-6 md:p-8 rounded-2xl border-2 border-red-400 text-center max-w-lg w-full">
                    <div class="text-5xl md:text-6xl mb-4">💀</div>
                    <h2 class="text-2xl md:text-3xl font-bold mb-4 text-red-400">GAME OVER!</h2>
                    <p class="text-lg text-gray-300 mb-2">Nyawa habis!</p>
                    <p id="finalScore" class="text-xl font-bold text-yellow-400 mb-6"></p>
                    <button onclick="restartGame()" class="bg-gradient-to-r from-green-600 to-emerald-600 px-8 py-3 rounded-lg font-bold hover:from-green-500 hover:to-emerald-500 transition-all">
                        🔄 MAIN LAGI
                    </button>
                </div>
            </div>
            
            <!-- Level Complete Modal -->
            <div id="levelCompleteModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50 p-4">
                <div class="bg-gradient-to-br from-green-900 to-blue-900 p-6 md:p-8 rounded-2xl border-2 border-yellow-400 text-center max-w-lg w-full">
                    <div class="text-5xl md:text-6xl mb-4">🏆</div>
                    <h2 class="text-2xl md:text-3xl font-bold mb-4 text-yellow-400">SELAMAT!</h2>
                    <p class="text-lg text-gray-300 mb-2">Telah Menyelesaikan Level 1</p>
                    <p id="levelScore" class="text-xl font-bold text-green-400 mb-4"></p>
                    <p class="text-base text-gray-300 mb-6">Klik Lanjutkan Untuk Menantang Level Selanjutnya!</p>
                    <div class="space-y-4">
                        <button onclick="nextLevel()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 px-8 py-3 rounded-lg font-bold hover:from-blue-500 hover:to-purple-500 transition-all">
                            🚀 LANJUT LV 2
                        </button>
                        <button onclick="exitGame()" class="w-full bg-gradient-to-r from-gray-600 to-gray-700 px-8 py-3 rounded-lg font-bold hover:from-gray-500 hover:to-gray-600 transition-all">
                            🚪 KELUAR
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kingdom Exploration Page -->
        <div id="kingdomExploration" class="hidden min-h-screen relative overflow-hidden">
            <!-- Fixed Sky Background -->
            <div class="absolute inset-0 bg-gradient-to-b from-blue-300 to-blue-500"></div>
            
            <!-- Game Character (Fixed Position - Front Layer) -->
            <div id="gameCharacter" class="absolute bottom-28 transition-all duration-300 ease-in-out z-50" style="left: 30%;">
                <div id="characterSprite" class="w-28 h-34">
                    <!-- Character will be inserted here based on selected role -->
                </div>
            </div>
            
            <!-- Scrolling Background Container -->
            <div id="scrollingBackground" class="absolute inset-0 transition-transform duration-100 ease-linear" style="transform: translateX(0px);">
                <!-- Repeating Background Pattern -->
                <div class="absolute inset-0" style="width: 800%;">
                    <!-- Diverse Cloud Patterns -->
                    <!-- Large Fluffy Clouds -->
                    <div class="absolute top-8 left-10 w-32 h-16 bg-white rounded-full opacity-90 shadow-lg"></div>
                    <div class="absolute top-6 left-18 w-24 h-12 bg-white rounded-full opacity-85"></div>
                    <div class="absolute top-10 left-14 w-20 h-10 bg-white rounded-full opacity-80"></div>
                    
                    <!-- Medium Cloud Cluster -->
                    <div class="absolute top-12 left-64 w-28 h-14 bg-white rounded-full opacity-85 shadow-md"></div>
                    <div class="absolute top-10 left-72 w-20 h-10 bg-white rounded-full opacity-80"></div>
                    <div class="absolute top-14 left-68 w-16 h-8 bg-white rounded-full opacity-75"></div>
                    
                    <!-- Small Scattered Clouds -->
                    <div class="absolute top-16 left-32 w-18 h-9 bg-white rounded-full opacity-70"></div>
                    <div class="absolute top-20 left-48 w-22 h-11 bg-white rounded-full opacity-75"></div>
                    <div class="absolute top-14 left-96 w-26 h-13 bg-white rounded-full opacity-80"></div>
                    
                    <!-- Large Background Clouds -->
                    <div class="absolute top-4 left-1/2 w-40 h-20 bg-white rounded-full opacity-60 shadow-xl"></div>
                    <div class="absolute top-2 left-1/2 transform translate-x-8 w-32 h-16 bg-white rounded-full opacity-55"></div>
                    <div class="absolute top-6 left-1/2 transform translate-x-4 w-28 h-14 bg-white rounded-full opacity-50"></div>
                    
                    <!-- Repeating Cloud Patterns -->
                    <div class="absolute top-18 w-24 h-12 bg-white rounded-full opacity-75" style="left: 12%;"></div>
                    <div class="absolute top-22 w-20 h-10 bg-white rounded-full opacity-70" style="left: 18%;"></div>
                    <div class="absolute top-8 w-30 h-15 bg-white rounded-full opacity-80" style="left: 25%;"></div>
                    <div class="absolute top-12 w-26 h-13 bg-white rounded-full opacity-75" style="left: 35%;"></div>
                    <div class="absolute top-16 w-22 h-11 bg-white rounded-full opacity-70" style="left: 45%;"></div>
                    <div class="absolute top-10 w-28 h-14 bg-white rounded-full opacity-85" style="left: 55%;"></div>
                    <div class="absolute top-14 w-24 h-12 bg-white rounded-full opacity-80" style="left: 65%;"></div>
                    <div class="absolute top-18 w-20 h-10 bg-white rounded-full opacity-75" style="left: 75%;"></div>
                    <div class="absolute top-6 w-32 h-16 bg-white rounded-full opacity-85" style="left: 85%;"></div>
                    <div class="absolute top-20 w-18 h-9 bg-white rounded-full opacity-70" style="left: 95%;"></div>
                    
                    <!-- Additional Varied Clouds -->
                    <div class="absolute top-24 w-16 h-8 bg-white rounded-full opacity-65" style="left: 8%;"></div>
                    <div class="absolute top-26 w-20 h-10 bg-white rounded-full opacity-70" style="left: 22%;"></div>
                    <div class="absolute top-28 w-24 h-12 bg-white rounded-full opacity-75" style="left: 38%;"></div>
                    <div class="absolute top-30 w-18 h-9 bg-white rounded-full opacity-65" style="left: 52%;"></div>
                    <div class="absolute top-32 w-22 h-11 bg-white rounded-full opacity-70" style="left: 68%;"></div>
                    <div class="absolute top-34 w-26 h-13 bg-white rounded-full opacity-75" style="left: 82%;"></div>
                    <div class="absolute top-36 w-20 h-10 bg-white rounded-full opacity-70" style="left: 92%;"></div>
                    
                    <!-- Sky Background -->
                    <div class="absolute top-0 left-0 w-full h-2/3 bg-gradient-to-b from-blue-400 via-blue-300 to-blue-200"></div>
                    
                    <!-- Background Gradient (Dark Green with Blur) -->
                    <div class="absolute bottom-32 left-0 w-full h-1/2 bg-gradient-to-t from-green-900 via-green-800 to-green-700 backdrop-blur-sm"></div>
                    
                    <!-- Shadow Trees Background -->
                    <div class="absolute bottom-48 left-0 w-full h-1/3">
                        <div class="absolute bottom-0 left-5 w-8 h-16 bg-black opacity-30 rounded-full"></div>
                        <div class="absolute bottom-0 left-20 w-6 h-12 bg-black opacity-25 rounded-full"></div>
                        <div class="absolute bottom-0 left-32 w-10 h-20 bg-black opacity-35 rounded-full"></div>
                        <div class="absolute bottom-0 left-48 w-7 h-14 bg-black opacity-30 rounded-full"></div>
                        <div class="absolute bottom-0 left-64 w-9 h-18 bg-black opacity-32 rounded-full"></div>
                        <div class="absolute bottom-0 left-80 w-5 h-10 bg-black opacity-28 rounded-full"></div>
                        <div class="absolute bottom-0 left-96 w-8 h-16 bg-black opacity-30 rounded-full"></div>
                        <div class="absolute bottom-0 left-112 w-6 h-12 bg-black opacity-25 rounded-full"></div>
                        <div class="absolute bottom-0 left-128 w-10 h-20 bg-black opacity-35 rounded-full"></div>
                        <div class="absolute bottom-0 left-144 w-7 h-14 bg-black opacity-30 rounded-full"></div>
                        <div class="absolute bottom-0 left-160 w-9 h-18 bg-black opacity-32 rounded-full"></div>
                        <div class="absolute bottom-0 left-176 w-5 h-10 bg-black opacity-28 rounded-full"></div>
                        <div class="absolute bottom-0 left-192 w-8 h-16 bg-black opacity-30 rounded-full"></div>
                        <div class="absolute bottom-0 left-208 w-6 h-12 bg-black opacity-25 rounded-full"></div>
                        <div class="absolute bottom-0 left-224 w-10 h-20 bg-black opacity-35 rounded-full"></div>
                        <div class="absolute bottom-0 left-240 w-7 h-14 bg-black opacity-30 rounded-full"></div>
                        <div class="absolute bottom-0 left-256 w-9 h-18 bg-black opacity-32 rounded-full"></div>
                        <div class="absolute bottom-0 left-272 w-5 h-10 bg-black opacity-28 rounded-full"></div>
                        <div class="absolute bottom-0 left-288 w-8 h-16 bg-black opacity-30 rounded-full"></div>
                        <div class="absolute bottom-0 left-304 w-6 h-12 bg-black opacity-25 rounded-full"></div>
                    </div>
                    
                    <!-- Mountains (Lowered and More Realistic) -->
                    <div class="absolute bottom-1/3 left-0 w-full h-2/3">
                        <svg viewBox="0 0 28800 400" class="w-full h-full">
                            <!-- Mountain Layer 1 - Realistic mountain ranges with gentle slopes -->
                            <polygon points="0,400 0,280 200,250 400,200 600,180 800,160 1000,140 1200,120 1400,100 1600,90 1800,85 2000,95 2200,110 2400,130 2600,155 2800,180 3000,200 3200,220 3400,235 3600,245 3800,250 4000,245 4200,235 4400,220 4600,200 4800,175 5000,150 5200,125 5400,105 5600,90 5800,80 6000,75 6200,80 6400,90 6600,105 6800,125 7000,150 7200,175 7400,200 7600,220 7800,235 8000,245 8200,250 8400,245 8600,235 8800,220 9000,200 9200,175 9400,150 9600,125 9800,105 10000,90 10200,80 10400,75 10600,80 10800,90 11000,105 11200,125 11400,150 11600,175 11800,200 12000,220 12200,235 12400,245 12600,250 12800,245 13000,235 13200,220 13400,200 13600,175 13800,150 14000,125 14200,105 14400,90 14600,80 14800,75 15000,80 15200,90 15400,105 15600,125 15800,150 16000,175 16200,200 16400,220 16600,235 16800,245 17000,250 17200,245 17400,235 17600,220 17800,200 18000,175 18200,150 18400,125 18600,105 18800,90 19000,80 19200,75 19400,80 19600,90 19800,105 20000,125 20200,150 20400,175 20600,200 20800,220 21000,235 21200,245 21400,250 21600,245 21800,235 22000,220 22200,200 22400,175 22600,150 22800,125 23000,105 23200,90 23400,80 23600,75 23800,80 24000,90 24200,105 24400,125 24600,150 24800,175 25000,200 25200,220 25400,235 25600,245 25800,250 26000,245 26200,235 26400,220 26600,200 26800,175 27000,150 27200,125 27400,105 27600,90 27800,80 28000,75 28200,80 28400,90 28600,105 28800,125 28800,400" fill="#4a5568" opacity="0.8"/>
                            <!-- Mountain Layer 2 - Background mountains with different peaks -->
                            <polygon points="0,400 0,320 300,290 600,260 900,240 1200,220 1500,200 1800,185 2100,175 2400,170 2700,175 3000,185 3300,200 3600,220 3900,240 4200,260 4500,280 4800,295 5100,305 5400,310 5700,305 6000,295 6300,280 6600,260 6900,240 7200,220 7500,200 7800,185 8100,175 8400,170 8700,175 9000,185 9300,200 9600,220 9900,240 10200,260 10500,280 10800,295 11100,305 11400,310 11700,305 12000,295 12300,280 12600,260 12900,240 13200,220 13500,200 13800,185 14100,175 14400,170 14700,175 15000,185 15300,200 15600,220 15900,240 16200,260 16500,280 16800,295 17100,305 17400,310 17700,305 18000,295 18300,280 18600,260 18900,240 19200,220 19500,200 19800,185 20100,175 20400,170 20700,175 21000,185 21300,200 21600,220 21900,240 22200,260 22500,280 22800,295 23100,305 23400,310 23700,305 24000,295 24300,280 24600,260 24900,240 25200,220 25500,200 25800,185 26100,175 26400,170 26700,175 27000,185 27300,200 27600,220 27900,240 28200,260 28500,280 28800,295 28800,400" fill="#2d3748" opacity="0.6"/>
                            <!-- Mountain Layer 3 - Distant mountains for more depth -->
                            <polygon points="0,400 0,350 400,330 800,315 1200,305 1600,300 2000,305 2400,315 2800,330 3200,345 3600,355 4000,360 4400,355 4800,345 5200,330 5600,315 6000,305 6400,300 6800,305 7200,315 7600,330 8000,345 8400,355 8800,360 9200,355 9600,345 10000,330 10400,315 10800,305 11200,300 11600,305 12000,315 12400,330 12800,345 13200,355 13600,360 14000,355 14400,345 14800,330 15200,315 15600,305 16000,300 16400,305 16800,315 17200,330 17600,345 18000,355 18400,360 18800,355 19200,345 19600,330 20000,315 20400,305 20800,300 21200,305 21600,315 22000,330 22400,345 22800,355 23200,360 23600,355 24000,345 24400,330 24800,315 25200,305 25600,300 26000,305 26400,315 26800,330 27200,345 27600,355 28000,360 28400,355 28800,345 28800,400" fill="#1a202c" opacity="0.4"/>
                        </svg>
                    </div>
                    
                    <!-- Main Castle (Bigger) -->
                    <div class="absolute bottom-32 left-1/2 transform -translate-x-1/2 z-10">
                        <svg viewBox="0 0 300 200" class="w-160 h-108">
                            <!-- Castle Base -->
                            <rect x="75" y="100" width="150" height="100" fill="#8b7355" stroke="#6b5b47" stroke-width="3"/>
                            <!-- Castle Towers -->
                            <rect x="45" y="70" width="45" height="130" fill="#a0845c" stroke="#8b7355" stroke-width="3"/>
                            <rect x="210" y="70" width="45" height="130" fill="#a0845c" stroke="#8b7355" stroke-width="3"/>
                            <rect x="127.5" y="40" width="45" height="160" fill="#a0845c" stroke="#8b7355" stroke-width="3"/>
                            
                            <!-- Tower Tops -->
                            <polygon points="45,70 67.5,40 90,70" fill="#8b4513"/>
                            <polygon points="210,70 232.5,40 255,70" fill="#8b4513"/>
                            <polygon points="127.5,40 150,10 172.5,40" fill="#8b4513"/>
                            
                            <!-- Castle Gate -->
                            <rect x="127.5" y="150" width="45" height="50" fill="#4a4a4a" rx="22.5"/>
                            
                            <!-- Windows -->
                            <rect x="60" y="100" width="12" height="18" fill="#4a4a4a"/>
                            <rect x="60" y="130" width="12" height="18" fill="#4a4a4a"/>
                            <rect x="228" y="100" width="12" height="18" fill="#4a4a4a"/>
                            <rect x="228" y="130" width="12" height="18" fill="#4a4a4a"/>
                            <rect x="142.5" y="80" width="12" height="18" fill="#4a4a4a"/>
                            <rect x="90" y="120" width="12" height="18" fill="#4a4a4a"/>
                            <rect x="198" y="120" width="12" height="18" fill="#4a4a4a"/>
                            
                            <!-- Flags -->
                            <rect x="66" y="40" width="3" height="30" fill="#8b4513"/>
                            <rect x="231" y="40" width="3" height="30" fill="#8b4513"/>
                            <rect x="148.5" y="10" width="3" height="30" fill="#8b4513"/>
                            <polygon points="69,40 69,55 84,47.5" fill="#dc2626"/>
                            <polygon points="234,40 234,55 249,47.5" fill="#dc2626"/>
                            <polygon points="151.5,10 151.5,25 166.5,17.5" fill="#dc2626"/>
                        </svg>
                    </div>
                    
                    <!-- Very Large Background Castles (3x character size) -->
                    <!-- Large Castle 1 -->
                    <div class="absolute bottom-32 z-5" style="left: 8%;">
                        <svg viewBox="0 0 400 300" class="w-84 h-102">
                            <!-- Main Castle Body -->
                            <rect x="100" y="150" width="200" height="150" fill="#6b5b47" stroke="#5a4a3a" stroke-width="4"/>
                            <!-- Left Tower -->
                            <rect x="50" y="100" width="80" height="200" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Right Tower -->
                            <rect x="270" y="100" width="80" height="200" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Center Tower -->
                            <rect x="175" y="50" width="80" height="250" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            
                            <!-- Tower Tops -->
                            <polygon points="50,100 90,50 130,100" fill="#654321"/>
                            <polygon points="270,100 310,50 350,100" fill="#654321"/>
                            <polygon points="175,50 215,0 255,50" fill="#654321"/>
                            
                            <!-- Main Gate -->
                            <rect x="175" y="220" width="80" height="80" fill="#2a2a2a" rx="40"/>
                            
                            <!-- Windows -->
                            <rect x="70" y="140" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="70" y="190" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="290" y="140" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="290" y="190" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="195" y="100" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="120" y="180" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="260" y="180" width="20" height="30" fill="#2a2a2a"/>
                            
                            <!-- Flags -->
                            <rect x="88" y="50" width="4" height="50" fill="#654321"/>
                            <rect x="308" y="50" width="4" height="50" fill="#654321"/>
                            <rect x="213" y="0" width="4" height="50" fill="#654321"/>
                            <polygon points="92,50 92,75 115,62.5" fill="#dc2626"/>
                            <polygon points="312,50 312,75 335,62.5" fill="#dc2626"/>
                            <polygon points="217,0 217,25 240,12.5" fill="#dc2626"/>
                        </svg>
                    </div>
                    
                    <!-- Large Castle 2 -->
                    <div class="absolute bottom-32 z-5" style="left: 25%;">
                        <svg viewBox="0 0 380 280" class="w-80 h-96">
                            <!-- Main Castle Body -->
                            <rect x="90" y="140" width="200" height="140" fill="#6b5b47" stroke="#5a4a3a" stroke-width="4"/>
                            <!-- Left Tower -->
                            <rect x="40" y="90" width="70" height="190" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Right Tower -->
                            <rect x="270" y="90" width="70" height="190" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Center Tower -->
                            <rect x="165" y="40" width="70" height="240" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            
                            <!-- Tower Tops -->
                            <polygon points="40,90 75,40 110,90" fill="#654321"/>
                            <polygon points="270,90 305,40 340,90" fill="#654321"/>
                            <polygon points="165,40 200,0 235,40" fill="#654321"/>
                            
                            <!-- Main Gate -->
                            <rect x="165" y="210" width="70" height="70" fill="#2a2a2a" rx="35"/>
                            
                            <!-- Windows -->
                            <rect x="60" y="130" width="18" height="25" fill="#2a2a2a"/>
                            <rect x="60" y="170" width="18" height="25" fill="#2a2a2a"/>
                            <rect x="285" y="130" width="18" height="25" fill="#2a2a2a"/>
                            <rect x="285" y="170" width="18" height="25" fill="#2a2a2a"/>
                            <rect x="185" y="90" width="18" height="25" fill="#2a2a2a"/>
                            
                            <!-- Flags -->
                            <rect x="73" y="40" width="4" height="50" fill="#654321"/>
                            <rect x="303" y="40" width="4" height="50" fill="#654321"/>
                            <rect x="198" y="0" width="4" height="50" fill="#654321"/>
                            <polygon points="77,40 77,65 100,52.5" fill="#dc2626"/>
                            <polygon points="307,40 307,65 330,52.5" fill="#dc2626"/>
                            <polygon points="202,0 202,25 225,12.5" fill="#dc2626"/>
                        </svg>
                    </div>
                    
                    <!-- Large Castle 3 -->
                    <div class="absolute bottom-32 z-5" style="left: 45%;">
                        <svg viewBox="0 0 420 320" class="w-88 h-108">
                            <!-- Main Castle Body -->
                            <rect x="110" y="160" width="200" height="160" fill="#6b5b47" stroke="#5a4a3a" stroke-width="4"/>
                            <!-- Left Tower -->
                            <rect x="60" y="110" width="75" height="210" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Right Tower -->
                            <rect x="285" y="110" width="75" height="210" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Center Tower -->
                            <rect x="185" y="60" width="75" height="260" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            
                            <!-- Tower Tops -->
                            <polygon points="60,110 97.5,60 135,110" fill="#654321"/>
                            <polygon points="285,110 322.5,60 360,110" fill="#654321"/>
                            <polygon points="185,60 222.5,10 260,60" fill="#654321"/>
                            
                            <!-- Main Gate -->
                            <rect x="185" y="230" width="75" height="90" fill="#2a2a2a" rx="37.5"/>
                            
                            <!-- Windows -->
                            <rect x="80" y="150" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="80" y="200" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="305" y="150" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="305" y="200" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="205" y="110" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="130" y="190" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="270" y="190" width="20" height="30" fill="#2a2a2a"/>
                            
                            <!-- Flags -->
                            <rect x="95" y="60" width="5" height="50" fill="#654321"/>
                            <rect x="320" y="60" width="5" height="50" fill="#654321"/>
                            <rect x="220" y="10" width="5" height="50" fill="#654321"/>
                            <polygon points="100,60 100,85 125,72.5" fill="#dc2626"/>
                            <polygon points="325,60 325,85 350,72.5" fill="#dc2626"/>
                            <polygon points="225,10 225,35 250,22.5" fill="#dc2626"/>
                        </svg>
                    </div>
                    
                    <!-- Large Castle 4 -->
                    <div class="absolute bottom-32 z-5" style="left: 65%;">
                        <svg viewBox="0 0 360 260" class="w-76 h-88">
                            <!-- Main Castle Body -->
                            <rect x="80" y="130" width="200" height="130" fill="#6b5b47" stroke="#5a4a3a" stroke-width="4"/>
                            <!-- Left Tower -->
                            <rect x="30" y="80" width="70" height="180" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Right Tower -->
                            <rect x="260" y="80" width="70" height="180" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Center Tower -->
                            <rect x="155" y="30" width="70" height="230" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            
                            <!-- Tower Tops -->
                            <polygon points="30,80 65,30 100,80" fill="#654321"/>
                            <polygon points="260,80 295,30 330,80" fill="#654321"/>
                            <polygon points="155,30 190,0 225,30" fill="#654321"/>
                            
                            <!-- Main Gate -->
                            <rect x="155" y="200" width="70" height="60" fill="#2a2a2a" rx="35"/>
                            
                            <!-- Windows -->
                            <rect x="50" y="120" width="18" height="25" fill="#2a2a2a"/>
                            <rect x="50" y="160" width="18" height="25" fill="#2a2a2a"/>
                            <rect x="280" y="120" width="18" height="25" fill="#2a2a2a"/>
                            <rect x="280" y="160" width="18" height="25" fill="#2a2a2a"/>
                            <rect x="175" y="80" width="18" height="25" fill="#2a2a2a"/>
                            
                            <!-- Flags -->
                            <rect x="63" y="30" width="4" height="50" fill="#654321"/>
                            <rect x="293" y="30" width="4" height="50" fill="#654321"/>
                            <rect x="188" y="0" width="4" height="50" fill="#654321"/>
                            <polygon points="67,30 67,55 90,42.5" fill="#dc2626"/>
                            <polygon points="297,30 297,55 320,42.5" fill="#dc2626"/>
                            <polygon points="192,0 192,25 215,12.5" fill="#dc2626"/>
                        </svg>
                    </div>
                    
                    <!-- Large Castle 5 -->
                    <div class="absolute bottom-32 z-5" style="left: 85%;">
                        <svg viewBox="0 0 400 300" class="w-84 h-102">
                            <!-- Main Castle Body -->
                            <rect x="100" y="150" width="200" height="150" fill="#6b5b47" stroke="#5a4a3a" stroke-width="4"/>
                            <!-- Left Tower -->
                            <rect x="50" y="100" width="80" height="200" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Right Tower -->
                            <rect x="270" y="100" width="80" height="200" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            <!-- Center Tower -->
                            <rect x="175" y="50" width="80" height="250" fill="#8b7355" stroke="#6b5b47" stroke-width="4"/>
                            
                            <!-- Tower Tops -->
                            <polygon points="50,100 90,50 130,100" fill="#654321"/>
                            <polygon points="270,100 310,50 350,100" fill="#654321"/>
                            <polygon points="175,50 215,0 255,50" fill="#654321"/>
                            
                            <!-- Main Gate -->
                            <rect x="175" y="220" width="80" height="80" fill="#2a2a2a" rx="40"/>
                            
                            <!-- Windows -->
                            <rect x="70" y="140" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="70" y="190" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="290" y="140" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="290" y="190" width="20" height="30" fill="#2a2a2a"/>
                            <rect x="195" y="100" width="20" height="30" fill="#2a2a2a"/>
                            
                            <!-- Flags -->
                            <rect x="88" y="50" width="4" height="50" fill="#654321"/>
                            <rect x="308" y="50" width="4" height="50" fill="#654321"/>
                            <rect x="213" y="0" width="4" height="50" fill="#654321"/>
                            <polygon points="92,50 92,75 115,62.5" fill="#dc2626"/>
                            <polygon points="312,50 312,75 335,62.5" fill="#dc2626"/>
                            <polygon points="217,0 217,25 240,12.5" fill="#dc2626"/>
                        </svg>
                    </div>
                    
                    <!-- Second Castle -->
                    <div class="absolute bottom-32 transform -translate-x-1/2 z-10" style="left: 15%;">
                        <svg viewBox="0 0 200 150" class="w-108 h-82">
                            <rect x="60" y="85" width="80" height="65" fill="#8b7355" stroke="#6b5b47" stroke-width="2"/>
                            <rect x="35" y="65" width="30" height="85" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <rect x="135" y="65" width="30" height="85" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <polygon points="35,65 50,45 65,65" fill="#8b4513"/>
                            <polygon points="135,65 150,45 165,65" fill="#8b4513"/>
                            <rect x="85" y="115" width="30" height="35" fill="#4a4a4a" rx="15"/>
                            <rect x="45" y="85" width="10" height="15" fill="#4a4a4a"/>
                            <rect x="145" y="85" width="10" height="15" fill="#4a4a4a"/>
                        </svg>
                    </div>
                    
                    <!-- Third Castle -->
                    <div class="absolute bottom-32 transform -translate-x-1/2 z-10" style="left: 85%;">
                        <svg viewBox="0 0 180 140" class="w-102 h-75">
                            <rect x="50" y="80" width="80" height="60" fill="#8b7355" stroke="#6b5b47" stroke-width="2"/>
                            <rect x="30" y="60" width="25" height="80" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <rect x="125" y="60" width="25" height="80" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <rect x="77.5" y="45" width="25" height="95" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <polygon points="30,60 42.5,40 55,60" fill="#8b4513"/>
                            <polygon points="125,60 137.5,40 150,60" fill="#8b4513"/>
                            <polygon points="77.5,45 90,25 102.5,45" fill="#8b4513"/>
                            <rect x="77.5" y="110" width="25" height="30" fill="#4a4a4a" rx="12.5"/>
                        </svg>
                    </div>
                    
                    <!-- Dense Building Cluster 1 -->
                    <div class="absolute bottom-32 z-10" style="left: 5%;">
                        <svg viewBox="0 0 150 100" class="w-68 h-48">
                            <rect x="10" y="60" width="25" height="40" fill="#8b4513"/>
                            <polygon points="8,60 22.5,45 37,60" fill="#dc2626"/>
                            <rect x="18" y="75" width="5" height="15" fill="#4a4a4a"/>
                            <rect x="40" y="65" width="20" height="35" fill="#654321"/>
                            <polygon points="38,65 50,50 62,65" fill="#8b4513"/>
                            <rect x="45" y="80" width="4" height="12" fill="#4a4a4a"/>
                            <rect x="65" y="70" width="15" height="30" fill="#8b4513"/>
                            <polygon points="63,70 72.5,58 82,70" fill="#dc2626"/>
                            <rect x="85" y="75" width="18" height="25" fill="#654321"/>
                            <polygon points="83,75 94,62 105,75" fill="#8b4513"/>
                            <rect x="108" y="68" width="22" height="32" fill="#8b7355"/>
                            <polygon points="106,68 119,53 132,68" fill="#8b4513"/>
                            <rect x="115" y="85" width="6" height="10" fill="#4a4a4a"/>
                        </svg>
                    </div>
                    
                    <!-- Dense Building Cluster 2 -->
                    <div class="absolute bottom-32 z-10" style="left: 25%;">
                        <svg viewBox="0 0 120 90" class="w-54 h-41">
                            <rect x="5" y="55" width="20" height="35" fill="#8b4513"/>
                            <polygon points="3,55 15,42 27,55" fill="#dc2626"/>
                            <rect x="30" y="60" width="18" height="30" fill="#654321"/>
                            <polygon points="28,60 39,47 50,60" fill="#8b4513"/>
                            <rect x="55" y="50" width="25" height="40" fill="#8b7355"/>
                            <polygon points="53,50 67.5,35 82,50" fill="#8b4513"/>
                            <rect x="62" y="70" width="6" height="12" fill="#4a4a4a"/>
                            <rect x="85" y="65" width="15" height="25" fill="#8b4513"/>
                            <polygon points="83,65 92.5,52 102,65" fill="#dc2626"/>
                            <rect x="105" y="58" width="12" height="32" fill="#654321"/>
                            <polygon points="103,58 111,45 119,58" fill="#8b4513"/>
                        </svg>
                    </div>
                    
                    <!-- Dense Building Cluster 3 -->
                    <div class="absolute bottom-32 z-10" style="left: 65%;">
                        <svg viewBox="0 0 140 95" class="w-61 h-44">
                            <rect x="8" y="58" width="22" height="37" fill="#8b4513"/>
                            <polygon points="6,58 19,43 32,58" fill="#dc2626"/>
                            <rect x="35" y="62" width="16" height="33" fill="#654321"/>
                            <polygon points="33,62 43,49 53,62" fill="#8b4513"/>
                            <rect x="58" y="55" width="28" height="40" fill="#8b7355"/>
                            <polygon points="56,55 72,40 88,55" fill="#8b4513"/>
                            <rect x="65" y="75" width="7" height="15" fill="#4a4a4a"/>
                            <rect x="90" y="60" width="18" height="35" fill="#8b4513"/>
                            <polygon points="88,60 99,45 110,60" fill="#dc2626"/>
                            <rect x="112" y="65" width="20" height="30" fill="#654321"/>
                            <polygon points="110,65 122,52 134,65" fill="#8b4513"/>
                        </svg>
                    </div>
                    
                    <!-- Dense Building Cluster 4 -->
                    <div class="absolute bottom-32 z-10" style="left: 90%;">
                        <svg viewBox="0 0 110 85" class="w-51 h-37">
                            <rect x="5" y="52" width="18" height="33" fill="#8b4513"/>
                            <polygon points="3,52 14,39 25,52" fill="#dc2626"/>
                            <rect x="28" y="58" width="15" height="27" fill="#654321"/>
                            <polygon points="26,58 35.5,45 45,58" fill="#8b4513"/>
                            <rect x="48" y="50" width="24" height="35" fill="#8b7355"/>
                            <polygon points="46,50 60,35 74,50" fill="#8b4513"/>
                            <rect x="55" y="70" width="6" height="12" fill="#4a4a4a"/>
                            <rect x="76" y="55" width="16" height="30" fill="#8b4513"/>
                            <polygon points="74,55 84,42 94,55" fill="#dc2626"/>
                            <rect x="96" y="62" width="12" height="23" fill="#654321"/>
                            <polygon points="94,62 102,49 110,62" fill="#8b4513"/>
                        </svg>
                    </div>
                    
                    <!-- Village Houses -->
                    <div class="absolute bottom-40 left-1/4">
                        <svg viewBox="0 0 120 80" class="w-54 h-41">
                            <rect x="20" y="50" width="40" height="30" fill="#8b4513"/>
                            <polygon points="15,50 40,30 65,50" fill="#dc2626"/>
                            <rect x="30" y="60" width="8" height="12" fill="#4a4a4a"/>
                            <rect x="45" y="55" width="6" height="8" fill="#4a4a4a"/>
                            <rect x="70" y="55" width="30" height="25" fill="#654321"/>
                            <polygon points="67,55 85,40 103,55" fill="#8b4513"/>
                            <rect x="78" y="65" width="6" height="10" fill="#4a4a4a"/>
                        </svg>
                    </div>
                    
                    <div class="absolute bottom-40 left-3/4">
                        <svg viewBox="0 0 100 70" class="w-48 h-34">
                            <rect x="15" y="45" width="35" height="25" fill="#8b4513"/>
                            <polygon points="12,45 32.5,30 53,45" fill="#dc2626"/>
                            <rect x="25" y="55" width="6" height="10" fill="#4a4a4a"/>
                            <rect x="35" y="50" width="5" height="6" fill="#4a4a4a"/>
                            <rect x="55" y="50" width="25" height="20" fill="#654321"/>
                            <polygon points="53,50 67.5,38 82,50" fill="#8b4513"/>
                        </svg>
                    </div>
                    
                    <!-- Windmill -->
                    <div class="absolute bottom-40" style="left: 60%;">
                        <svg viewBox="0 0 80 100" class="w-41 h-51">
                            <rect x="35" y="60" width="10" height="40" fill="#8b4513"/>
                            <circle cx="40" cy="50" r="15" fill="#e6e6e6" stroke="#c0c0c0" stroke-width="2"/>
                            <rect x="38" y="35" width="4" height="30" fill="#654321"/>
                            <rect x="25" y="48" width="30" height="4" fill="#654321"/>
                            <polygon points="40,35 35,25 45,25" fill="#f5f5f5"/>
                            <polygon points="55,50 65,45 65,55" fill="#f5f5f5"/>
                            <polygon points="40,65 45,75 35,75" fill="#f5f5f5"/>
                            <polygon points="25,50 15,55 15,45" fill="#f5f5f5"/>
                        </svg>
                    </div>
                    
                    <!-- Trees (Fast parallax) -->
                    <div class="absolute bottom-40 left-5 z-20">
                        <svg viewBox="0 0 60 80" class="w-34 h-41">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="20" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="15" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="15" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <div class="absolute bottom-40 left-20 z-20">
                        <svg viewBox="0 0 60 80" class="w-27 h-34">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="18" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="13" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="13" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <div class="absolute bottom-40 left-40 z-20">
                        <svg viewBox="0 0 60 80" class="w-31 h-37">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="20" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="15" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="15" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <div class="absolute bottom-40 left-56 z-20">
                        <svg viewBox="0 0 60 80" class="w-24 h-31">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="18" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="13" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="13" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <div class="absolute bottom-40 left-72 z-20">
                        <svg viewBox="0 0 60 80" class="w-20 h-24">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="20" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="15" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="15" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <div class="absolute bottom-40 left-96 z-20">
                        <svg viewBox="0 0 60 80" class="w-16 h-20">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="18" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="13" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="13" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <!-- More trees and buildings for continuous scrolling -->
                    <!-- Small Castle -->
                    <div class="absolute bottom-40" style="left: 8%;">
                        <svg viewBox="0 0 120 100" class="w-32 h-28">
                            <rect x="40" y="60" width="40" height="40" fill="#8b7355" stroke="#6b5b47" stroke-width="2"/>
                            <rect x="25" y="45" width="20" height="55" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <rect x="75" y="45" width="20" height="55" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <polygon points="25,45 35,30 45,45" fill="#8b4513"/>
                            <polygon points="75,45 85,30 95,45" fill="#8b4513"/>
                            <rect x="50" y="80" width="20" height="20" fill="#4a4a4a" rx="10"/>
                        </svg>
                    </div>
                    
                    <!-- Large Tree -->
                    <div class="absolute bottom-52" style="left: 12%;">
                        <svg viewBox="0 0 60 100" class="w-24 h-32">
                            <rect x="25" y="70" width="10" height="30" fill="#8b4513"/>
                            <circle cx="30" cy="60" r="25" fill="#22c55e"/>
                            <circle cx="22" cy="55" r="18" fill="#16a34a"/>
                            <circle cx="38" cy="55" r="18" fill="#16a34a"/>
                            <circle cx="30" cy="45" r="20" fill="#15803d"/>
                        </svg>
                    </div>
                    
                    <!-- Small House -->
                    <div class="absolute bottom-40" style="left: 18%;">
                        <svg viewBox="0 0 80 60" class="w-20 h-16">
                            <rect x="15" y="35" width="30" height="25" fill="#8b4513"/>
                            <polygon points="12,35 30,20 48,35" fill="#dc2626"/>
                            <rect x="22" y="45" width="6" height="10" fill="#4a4a4a"/>
                            <rect x="32" y="40" width="5" height="6" fill="#4a4a4a"/>
                            <rect x="50" y="40" width="20" height="20" fill="#654321"/>
                            <polygon points="48,40 60,28 72,40" fill="#8b4513"/>
                        </svg>
                    </div>
                    
                    <!-- Medium Tree -->
                    <div class="absolute bottom-52" style="left: 22%;">
                        <svg viewBox="0 0 60 80" class="w-18 h-24">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="20" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="15" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="15" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <!-- Tower -->
                    <div class="absolute bottom-40" style="left: 28%;">
                        <svg viewBox="0 0 60 120" class="w-16 h-32">
                            <rect x="20" y="40" width="20" height="80" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <polygon points="18,40 30,25 42,40" fill="#8b4513"/>
                            <rect x="25" y="80" width="10" height="15" fill="#4a4a4a" rx="5"/>
                            <rect x="23" y="55" width="6" height="8" fill="#4a4a4a"/>
                            <rect x="31" y="55" width="6" height="8" fill="#4a4a4a"/>
                        </svg>
                    </div>
                    
                    <!-- Small Tree -->
                    <div class="absolute bottom-52" style="left: 32%;">
                        <svg viewBox="0 0 60 80" class="w-14 h-18">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="18" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="13" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="13" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <!-- Large House -->
                    <div class="absolute bottom-40" style="left: 35%;">
                        <svg viewBox="0 0 100 80" class="w-28 h-22">
                            <rect x="20" y="50" width="40" height="30" fill="#8b4513"/>
                            <polygon points="15,50 40,30 65,50" fill="#dc2626"/>
                            <rect x="30" y="60" width="8" height="12" fill="#4a4a4a"/>
                            <rect x="45" y="55" width="6" height="8" fill="#4a4a4a"/>
                            <rect x="70" y="55" width="25" height="25" fill="#654321"/>
                            <polygon points="67,55 82.5,40 98,55" fill="#8b4513"/>
                        </svg>
                    </div>
                    
                    <!-- Medium Tree -->
                    <div class="absolute bottom-52" style="left: 42%;">
                        <svg viewBox="0 0 60 80" class="w-16 h-22">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="20" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="15" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="15" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <!-- Small Castle -->
                    <div class="absolute bottom-40" style="left: 68%;">
                        <svg viewBox="0 0 120 100" class="w-30 h-26">
                            <rect x="40" y="60" width="40" height="40" fill="#8b7355" stroke="#6b5b47" stroke-width="2"/>
                            <rect x="25" y="45" width="20" height="55" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <rect x="75" y="45" width="20" height="55" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <polygon points="25,45 35,30 45,45" fill="#8b4513"/>
                            <polygon points="75,45 85,30 95,45" fill="#8b4513"/>
                            <rect x="50" y="80" width="20" height="20" fill="#4a4a4a" rx="10"/>
                        </svg>
                    </div>
                    
                    <!-- Large Tree -->
                    <div class="absolute bottom-52" style="left: 72%;">
                        <svg viewBox="0 0 60 100" class="w-22 h-28">
                            <rect x="25" y="70" width="10" height="30" fill="#8b4513"/>
                            <circle cx="30" cy="60" r="25" fill="#22c55e"/>
                            <circle cx="22" cy="55" r="18" fill="#16a34a"/>
                            <circle cx="38" cy="55" r="18" fill="#16a34a"/>
                            <circle cx="30" cy="45" r="20" fill="#15803d"/>
                        </svg>
                    </div>
                    
                    <!-- Small House -->
                    <div class="absolute bottom-40" style="left: 78%;">
                        <svg viewBox="0 0 80 60" class="w-18 h-14">
                            <rect x="15" y="35" width="30" height="25" fill="#8b4513"/>
                            <polygon points="12,35 30,20 48,35" fill="#dc2626"/>
                            <rect x="22" y="45" width="6" height="10" fill="#4a4a4a"/>
                            <rect x="32" y="40" width="5" height="6" fill="#4a4a4a"/>
                        </svg>
                    </div>
                    
                    <!-- Medium Tree -->
                    <div class="absolute bottom-52" style="left: 82%;">
                        <svg viewBox="0 0 60 80" class="w-16 h-20">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="18" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="13" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="13" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <!-- Tower -->
                    <div class="absolute bottom-40" style="left: 88%;">
                        <svg viewBox="0 0 60 120" class="w-14 h-28">
                            <rect x="20" y="40" width="20" height="80" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <polygon points="18,40 30,25 42,40" fill="#8b4513"/>
                            <rect x="25" y="80" width="10" height="15" fill="#4a4a4a" rx="5"/>
                            <rect x="23" y="55" width="6" height="8" fill="#4a4a4a"/>
                            <rect x="31" y="55" width="6" height="8" fill="#4a4a4a"/>
                        </svg>
                    </div>
                    
                    <!-- Large Tree -->
                    <div class="absolute bottom-52" style="left: 92%;">
                        <svg viewBox="0 0 60 100" class="w-20 h-26">
                            <rect x="25" y="70" width="10" height="30" fill="#8b4513"/>
                            <circle cx="30" cy="60" r="25" fill="#22c55e"/>
                            <circle cx="22" cy="55" r="18" fill="#16a34a"/>
                            <circle cx="38" cy="55" r="18" fill="#16a34a"/>
                            <circle cx="30" cy="45" r="20" fill="#15803d"/>
                        </svg>
                    </div>
                    
                    <!-- Additional Buildings Pattern -->
                    <div class="absolute bottom-40" style="left: 45%;">
                        <svg viewBox="0 0 80 60" class="w-22 h-18">
                            <rect x="10" y="35" width="25" height="25" fill="#8b4513"/>
                            <polygon points="8,35 22.5,20 37,35" fill="#dc2626"/>
                            <rect x="18" y="45" width="5" height="10" fill="#4a4a4a"/>
                            <rect x="25" y="40" width="4" height="5" fill="#4a4a4a"/>
                            <rect x="45" y="40" width="20" height="20" fill="#654321"/>
                            <polygon points="43,40 55,28 67,40" fill="#8b4513"/>
                        </svg>
                    </div>
                    
                    <!-- Small Tree -->
                    <div class="absolute bottom-52" style="left: 48%;">
                        <svg viewBox="0 0 60 80" class="w-14 h-18">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="18" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="13" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="13" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <!-- Medium House -->
                    <div class="absolute bottom-40" style="left: 52%;">
                        <svg viewBox="0 0 70 50" class="w-20 h-16">
                            <rect x="15" y="30" width="20" height="20" fill="#8b4513"/>
                            <polygon points="13,30 25,18 37,30" fill="#dc2626"/>
                            <rect x="20" y="38" width="4" height="8" fill="#4a4a4a"/>
                            <rect x="40" y="35" width="15" height="15" fill="#654321"/>
                            <polygon points="38,35 47.5,25 57,35" fill="#8b4513"/>
                        </svg>
                    </div>
                    
                    <!-- Large Tree -->
                    <div class="absolute bottom-52" style="left: 56%;">
                        <svg viewBox="0 0 60 100" class="w-22 h-28">
                            <rect x="25" y="70" width="10" height="30" fill="#8b4513"/>
                            <circle cx="30" cy="60" r="25" fill="#22c55e"/>
                            <circle cx="22" cy="55" r="18" fill="#16a34a"/>
                            <circle cx="38" cy="55" r="18" fill="#16a34a"/>
                            <circle cx="30" cy="45" r="20" fill="#15803d"/>
                        </svg>
                    </div>
                    
                    <!-- Small Tower -->
                    <div class="absolute bottom-40" style="left: 62%;">
                        <svg viewBox="0 0 60 120" class="w-12 h-24">
                            <rect x="20" y="40" width="20" height="80" fill="#a0845c" stroke="#8b7355" stroke-width="2"/>
                            <polygon points="18,40 30,25 42,40" fill="#8b4513"/>
                            <rect x="25" y="80" width="10" height="15" fill="#4a4a4a" rx="5"/>
                            <rect x="23" y="55" width="6" height="8" fill="#4a4a4a"/>
                            <rect x="31" y="55" width="6" height="8" fill="#4a4a4a"/>
                        </svg>
                    </div>
                    
                    <!-- Medium Tree -->
                    <div class="absolute bottom-52" style="left: 65%;">
                        <svg viewBox="0 0 60 80" class="w-16 h-20">
                            <rect x="25" y="60" width="10" height="20" fill="#8b4513"/>
                            <circle cx="30" cy="50" r="18" fill="#22c55e"/>
                            <circle cx="25" cy="45" r="13" fill="#16a34a"/>
                            <circle cx="35" cy="45" r="13" fill="#16a34a"/>
                        </svg>
                    </div>
                    
                    <!-- Ground/Path -->
                    <div class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-green-800 to-green-600 z-0"></div>
                    <div class="absolute bottom-0 left-0 w-full h-8 bg-gradient-to-r from-yellow-800 via-yellow-600 to-yellow-800 opacity-60 z-0"></div>
                </div>
            </div>
            
            <!-- Player Info -->
            <div class="absolute top-2 sm:top-4 left-2 sm:left-4 bg-black bg-opacity-70 p-2 sm:p-3 md:p-4 rounded-lg border-2 border-yellow-400 max-w-xs sm:max-w-sm">
                <div class="text-yellow-400 font-bold text-xs sm:text-sm md:text-lg" id="playerInfoDisplay">
                    <!-- Player info will be inserted here -->
                </div>
                <div class="text-green-400 font-semibold text-xs sm:text-sm mt-1 sm:mt-2" id="questProgress">
                    Quest: <span id="questCounter">0</span>/<span id="totalQuests">12</span>
                </div>
            </div>
            

            
            <!-- Game Controller -->
            <div class="absolute bottom-2 sm:bottom-4 left-2 sm:left-4">
                <div class="bg-gray-800 bg-opacity-90 p-3 sm:p-4 md:p-6 rounded-2xl border-2 border-gray-600 shadow-2xl">
                    <!-- Forward/Backward Controller -->
                    <div class="flex items-center justify-center space-x-4 sm:space-x-6 md:space-x-8">
                        <!-- Backward Button -->
                        <button id="backwardBtn" onmousedown="startMoving('backward')" onmouseup="stopMoving()" onmouseleave="stopMoving()" ontouchstart="startMoving('backward')" ontouchend="stopMoving()"
                                class="w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-400 hover:to-red-500 rounded-full flex items-center justify-center text-white font-bold text-lg sm:text-xl md:text-2xl transition-all active:scale-95 shadow-lg">
                            ←
                        </button>
                        
                        <!-- Center Indicator -->
                        <div class="w-6 h-6 sm:w-7 sm:h-7 md:w-8 md:h-8 bg-gray-700 rounded-full border-2 border-gray-500 flex items-center justify-center">
                            <div class="w-2 h-2 sm:w-2.5 sm:h-2.5 md:w-3 md:h-3 bg-green-400 rounded-full animate-pulse"></div>
                        </div>
                        
                        <!-- Forward Button -->
                        <button id="forwardBtn" onmousedown="startMoving('forward')" onmouseup="stopMoving()" onmouseleave="stopMoving()" ontouchstart="startMoving('forward')" ontouchend="stopMoving()"
                                class="w-12 h-12 sm:w-14 sm:h-14 md:w-16 md:h-16 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-400 hover:to-green-500 rounded-full flex items-center justify-center text-white font-bold text-lg sm:text-xl md:text-2xl transition-all active:scale-95 shadow-lg">
                            →
                        </button>
                    </div>
                    
                    <!-- Controller Labels -->
                    <div class="flex justify-between mt-2 sm:mt-3 text-gray-400 text-xs font-semibold">
                        <span>MUNDUR</span>
                        <span>🎮</span>
                        <span>MAJU</span>
                    </div>
                </div>
            </div>
            
            <!-- Quest Modal -->
            <div id="questModal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center hidden z-50 p-2 sm:p-4">
                <div class="bg-gradient-to-br from-purple-900 to-blue-900 p-4 sm:p-6 md:p-8 rounded-2xl border-2 border-yellow-400 text-center max-w-2xl w-full mx-2 sm:mx-4 max-h-screen overflow-y-auto">
                    <div class="text-4xl sm:text-5xl md:text-6xl mb-3 sm:mb-4">📜</div>
                    <h2 id="questTitle" class="text-xl sm:text-2xl md:text-3xl font-bold mb-3 sm:mb-4 text-yellow-400"></h2>
                    <p id="questContent" class="text-sm sm:text-base md:text-lg text-gray-300 mb-4 sm:mb-6 leading-relaxed"></p>
                    <div id="questButtons" class="space-y-3 sm:space-y-0 sm:space-x-4 flex flex-col sm:flex-row">
                        <button id="continueQuestBtn" class="w-full sm:w-auto bg-gradient-to-r from-blue-600 to-purple-600 px-6 sm:px-8 py-4 sm:py-3 rounded-lg font-bold hover:from-blue-500 hover:to-purple-500 active:from-blue-700 active:to-purple-700 transition-all text-sm sm:text-base min-h-[48px] touch-manipulation select-none cursor-pointer">
                            Lanjutkan Petualangan 🚀
                        </button>
                        <button id="registerBtn" class="w-full sm:w-auto bg-gradient-to-r from-green-600 to-emerald-600 px-6 sm:px-8 py-4 sm:py-3 rounded-lg font-bold hover:from-green-500 hover:to-emerald-500 active:from-green-700 active:to-emerald-700 transition-all hidden text-sm sm:text-base min-h-[48px] touch-manipulation select-none cursor-pointer">
                            🎯 DAFTAR SEBAGAI PETUALANG
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let selectedRoleCard = null;
        let selectedRoleName = '';
        let playerName = '';
        let playerGender = '';
        
        // Handle character creation form
        document.getElementById('characterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            playerName = document.getElementById('characterName').value.trim();
            const genderInput = document.querySelector('input[name="gender"]:checked');
            
            if (playerName && genderInput) {
                playerGender = genderInput.value;
                
                // Update player info display
                const genderIcon = playerGender === 'Pria' ? '👨‍⚔️' : '👩‍⚔️';
                document.getElementById('playerInfo').innerHTML = 
                    `Selamat datang, <span class="text-yellow-400 font-bold">${playerName}</span> ${genderIcon}`;
                
                // Hide character creation and show role selection
                document.getElementById('characterCreation').classList.add('hidden');
                document.getElementById('roleSelection').classList.remove('hidden');
                
                // Smooth scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
        
        // Create animated stars
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }
        
        function selectRole(card, roleName) {
            // Remove previous selection
            if (selectedRoleCard) {
                selectedRoleCard.classList.remove('selected');
            }
            
            // Add selection to current card
            card.classList.add('selected');
            selectedRoleCard = card;
            selectedRoleName = roleName;
            
            // Show selected role info
            document.getElementById('selectedRole').classList.remove('hidden');
            document.getElementById('selectedRoleName').textContent = roleName;
            document.getElementById('confirmBtn').classList.remove('hidden');
            
            // Scroll to selection
            document.getElementById('selectedRole').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center' 
            });
        }
        
        function confirmSelection() {
            if (selectedRoleName) {
                // Prepare modal content first
                const genderIcon = playerGender === 'Pria' ? '👨‍⚔️' : '👩‍⚔️';
                document.getElementById('finalRole').innerHTML = 
                    `<span class="text-yellow-400">${playerName}</span> ${genderIcon}<br>
                     <span class="text-green-400">${selectedRoleName}</span>`;
                
                // Copy the selected role icon to modal
                displayRoleInModal();
                
                // Show modal immediately
                document.getElementById('successModal').classList.remove('hidden');
                
                // Send data to Google Sheets in background
                sendToGoogleSheets();
            }
        }
        
        function displayRoleInModal() {
            const modalRoleIcon = document.getElementById('modalRoleIcon');
            
            // Get the SVG from the selected role card
            if (selectedRoleCard) {
                const roleIconElement = selectedRoleCard.querySelector('.role-icon svg');
                if (roleIconElement) {
                    // Clone the SVG and add it to modal
                    const clonedSVG = roleIconElement.cloneNode(true);
                    clonedSVG.classList.remove('w-20', 'h-20');
                    clonedSVG.classList.add('role-icon-modal');
                    modalRoleIcon.innerHTML = '';
                    modalRoleIcon.appendChild(clonedSVG);
                }
            }
        }
        
        async function sendToGoogleSheets() {
            // URL Google Apps Script yang sudah dikonfigurasi
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyrNEa1Zi_wn4DVe3GMiGQ8PU3HZUZLR_Jbdp8WsTsIjvq-CBxX6sFxKf22xnXlhSqW1g/exec';
            
            const data = {
                timestamp: new Date().toLocaleString('id-ID'),
                playerName: playerName,
                gender: playerGender,
                selectedRole: selectedRoleName,
                userAgent: navigator.userAgent
            };
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Data berhasil dikirim ke Google Sheets!', data);
                
            } catch (error) {
                console.error('Error mengirim data:', error);
            }
        }
        
        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
        }
        
        async function saveAsImageAndClose() {
            try {
                // Get the modal content
                const modalContent = document.querySelector('#successModal .bg-gradient-to-br');
                
                // Configure html2canvas options
                const options = {
                    backgroundColor: null,
                    scale: 2, // Higher quality
                    useCORS: true,
                    allowTaint: true,
                    width: modalContent.offsetWidth,
                    height: modalContent.offsetHeight,
                    scrollX: 0,
                    scrollY: 0
                };
                
                // Capture the modal content
                const canvas = await html2canvas(modalContent, options);
                
                // Convert to blob
                canvas.toBlob(function(blob) {
                    // Create download link
                    const link = document.createElement('a');
                    link.download = `Thirdia Chronicles - ${playerName}.png`;
                    link.href = URL.createObjectURL(blob);
                    
                    // Trigger download
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // Clean up
                    URL.revokeObjectURL(link.href);
                    
                    // Close modal after download
                    closeModal();
                    
                    // Navigate to kingdom exploration
                    setTimeout(() => {
                        showKingdomExploration();
                    }, 500);
                }, 'image/png', 1.0);
                
            } catch (error) {
                console.error('Error capturing image:', error);
                // Still close modal and navigate
                closeModal();
                setTimeout(() => {
                    showKingdomExploration();
                }, 500);
            }
        }
        
        function showKingdomExploration() {
            // Hide all previous sections
            document.getElementById('characterCreation').classList.add('hidden');
            document.getElementById('roleSelection').classList.add('hidden');
            document.getElementById('successModal').classList.add('hidden');
            
            // Show kingdom exploration
            document.getElementById('kingdomExploration').classList.remove('hidden');
            
            // Start background music
            playBackgroundMusic();
            
            // Initialize character position
            initializeCharacter();
        }
        
        let backgroundOffset = 0; // Background scroll position
        let movementInterval = null;
        let isMoving = false;
        let totalDistance = 0;
        let questTriggers = [];
        let movementSpeed = 3; // Pixels per frame
        let completedQuests = 0;
        
        const quests = [
            {
                title: "Selamat Datang di Kerajaan Thirdia Chronicles",
                content: "Sebuah Kerajaan Fantasi Yang Akan Kalian Jelajahi Selama Kelas 3 Ini. Terus Lanjutkan Perjalanan Kalian Kedepan Untuk Mendapatkan Informasi Lainnya"
            },
            {
                title: "Kerajaan Thirdia",
                content: "Pusat kekuasaan dan awal semua petualangan. Di sinilah Raja (guru) tinggal dan mengatur seluruh wilayah Thirdia. Para pahlawan (murid) datang ke sini untuk menerima quest, merayakan pencapaian, dan memulai hari penuh petualangan. Istana ini juga menjadi tempat pengumuman penting dan pertemuan para petualang."
            },
            {
                title: "Lembah Ilahi (Pendidikan Agama)",
                content: "Wilayah damai tempat para petualang belajar nilai spiritual dan kebijaksanaan hati. Terdapat kuil-kuil suci dari berbagai keyakinan yang berdiri berdampingan di tengah lembah hijau. Petualang akan menjalani quest yang mengasah iman, moral, dan toleransi antarpenghuni."
            },
            {
                title: "Hutan Litera (Bahasa Indonesia)",
                content: "Hutan lebat penuh pohon-pohon kata dan makhluk-makhluk cerita. Di dalam hutan ini, para petualang menjelajahi kisah, memahami pesan tersembunyi, dan mengasah kemampuan berbicara dan menulis melalui berbagai quest literasi."
            },
            {
                title: "Kingdom of Lexiconia (Bahasa Inggris)",
                content: "Kerajaan megah penuh mantra-mantra dalam bahasa asing. Dipimpin oleh Queen Grammar dan Knight Vocabulary, wilayah ini mengajak petualang memahami dan menggunakan bahasa Inggris dalam percakapan dan tugas-tugas antarbangsa."
            },
            {
                title: "Padhepokan Aksara (Bahasa Jawa)",
                content: "Padepokan penuh pepatah dan aksara kuno. Sebuah tempat damai di mana petualang belajar unggah-ungguh, tembang-tembang tradisi, dan budaya Jawa yang penuh filosofi, diajarkan oleh para empu dan sesepuh."
            },
            {
                title: "Pulau Cakrawala (IPAS - Ilmu Pengetahuan Alam & Sosial)",
                content: "Pulau luas dengan gunung, sungai, dan desa-desa misterius. Setiap sudutnya menyimpan pengetahuan alam semesta dan kehidupan sosial. Petualang akan menjelajah fenomena alam, makhluk hidup, dan budaya masyarakat melalui quest observasi dan eksperimen."
            },
            {
                title: "Kampung Adilara (Pendidikan Pancasila)",
                content: "Kampung rukun dengan lima pilar suci di tengah alun-alunnya. Di sini, para petualang belajar tentang hak, kewajiban, nilai persatuan, demokrasi, dan keadilan. Quest-quest di kampung ini mengajarkan kebijaksanaan sebagai warga kerajaan yang baik."
            },
            {
                title: "Gunung Numeria (Matematika)",
                content: "Pegunungan tinggi penuh teka-teki angka dan labirin logika. Dipenuhi batu-batu hitung, kristal pecahan bilangan, dan goa geometri. Petualang menaklukkan tantangan hitung-menghitung dan strategi pemecahan masalah."
            },
            {
                title: "Padang Lincah (PJOK)",
                content: "Padang terbuka tempat ujian fisik dan ketangkasan. Arena tempat para petualang melatih kekuatan, kelincahan, dan kerja sama tim. Quest-nya berupa tantangan gerak, olahraga kerajaan, dan menjaga kesehatan tubuh."
            },
            {
                title: "Kota Warna (Seni Rupa)",
                content: "Kota ceria penuh warna dan inspirasi visual. Dinding-dindingnya dihiasi mural hidup, dan tiap jalanan mengarah ke bengkel seni. Para petualang menuangkan kreativitasnya lewat lukisan, patung, dan karya visual lainnya."
            },
            {
                title: "🎉 SELAMAT! PETUALANGAN PERTAMA SELESAI! 🎉",
                content: `Selamat!! Semua perkenalan tentang Thirdia Chronicles sudah kamu selesaikan sebagai seorang ${selectedRoleName}. Sekarang kamu siap untuk melanjutkan petualanganmu menjadi ${selectedRoleName} selama 1 tahun ini di kelas 3! Tekan tombol DAFTAR dibawah untuk mendaftarkan dirimu sebagai seorang Petualang baru di Kerajaan Thirdia`,
                isFinal: true
            }
        ];
        
        // Generate quest trigger distances - first quest at 100, then every 50 distance
        function generateQuestTriggers() {
            questTriggers = [];
            
            for (let i = 0; i < quests.length; i++) {
                let distance;
                if (i === 0) {
                    distance = 1000; // First quest at distance 100 (multiplied by 10 for internal distance)
                } else {
                    distance = 1000 + (i * 500); // Subsequent quests every 50 distance (500 internal units)
                }
                
                questTriggers.push({
                    distance: distance,
                    questIndex: i,
                    triggered: false
                });
            }
        }
        
        function playBackgroundMusic() {
            // Create audio context for RPG-style music
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // RPG-style melody notes (in Hz)
            const melody = [
                { freq: 523.25, duration: 0.5 }, // C5
                { freq: 587.33, duration: 0.5 }, // D5
                { freq: 659.25, duration: 0.5 }, // E5
                { freq: 698.46, duration: 0.5 }, // F5
                { freq: 783.99, duration: 1.0 }, // G5
                { freq: 659.25, duration: 0.5 }, // E5
                { freq: 587.33, duration: 0.5 }, // D5
                { freq: 523.25, duration: 1.0 }, // C5
            ];
            
            let currentTime = audioContext.currentTime;
            
            function playMelody() {
                melody.forEach((note, index) => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(note.freq, currentTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.1, currentTime + 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, currentTime + note.duration);
                    
                    oscillator.start(currentTime);
                    oscillator.stop(currentTime + note.duration);
                    
                    currentTime += note.duration;
                });
                
                // Loop the melody
                setTimeout(() => {
                    currentTime = audioContext.currentTime;
                    playMelody();
                }, melody.reduce((sum, note) => sum + note.duration, 0) * 1000 + 2000);
            }
            
            // Start playing after user interaction
            document.addEventListener('click', () => {
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        playMelody();
                    });
                }
            }, { once: true });
        }
        
        function initializeCharacter() {
            // Display player info with appropriate icon
            let genderIcon;
            if (selectedRoleName === 'Raja Thirdia') {
                genderIcon = '👑'; // Crown for King
            } else {
                genderIcon = playerGender === 'Pria' ? '👨‍⚔️' : '👩‍⚔️';
            }
            
            document.getElementById('playerInfoDisplay').innerHTML = 
                `${genderIcon} ${playerName}<br><span class="text-green-400">${selectedRoleName}</span><br><span class="text-yellow-400">Distance: <span id="distanceCounter">0</span></span>`;
            
            // Set character sprite based on selected role
            setCharacterSprite();
            
            // Generate random quest triggers
            generateQuestTriggers();
            
            // Reset positions and counters
            backgroundOffset = 0;
            totalDistance = 0;
            completedQuests = 0;
            updateQuestCounter();
            
            updateBackgroundPosition();
        }
        
        function setCharacterSprite() {
            const characterSprite = document.getElementById('characterSprite');
            
            // Check if this is the King character (admin access)
            if (selectedRoleName === 'Raja Thirdia') {
                // Use the special King character SVG
                characterSprite.innerHTML = createKingCharacterSVG();
            } else if (selectedRoleCard) {
                // Get the SVG from the selected role card and scale it down for game character
                const roleIconElement = selectedRoleCard.querySelector('.role-icon svg');
                if (roleIconElement) {
                    const clonedSVG = roleIconElement.cloneNode(true);
                    clonedSVG.classList.remove('w-20', 'h-20');
                    clonedSVG.classList.add('w-28', 'h-34');
                    clonedSVG.style.filter = 'drop-shadow(2px 2px 4px rgba(0,0,0,0.5))';
                    characterSprite.innerHTML = '';
                    characterSprite.appendChild(clonedSVG);
                }
            }
        }
        
        function startMoving(direction) {
            if (isMoving) return;
            
            isMoving = true;
            movementInterval = setInterval(() => {
                moveCharacter(direction);
            }, 16); // ~60fps for smooth movement
        }
        
        function stopMoving() {
            if (movementInterval) {
                clearInterval(movementInterval);
                movementInterval = null;
            }
            isMoving = false;
        }
        
        function moveCharacter(direction) {
            let moved = false;
            
            switch(direction) {
                case 'forward':
                    // Move background to the left (character appears to move right)
                    backgroundOffset -= movementSpeed;
                    totalDistance += movementSpeed;
                    moved = true;
                    break;
                case 'backward':
                    // Move background to the right (character appears to move left)
                    if (backgroundOffset < 0) { // Don't go past starting position
                        backgroundOffset += movementSpeed;
                        totalDistance -= movementSpeed;
                        if (totalDistance < 0) totalDistance = 0; // Don't go negative
                        moved = true;
                    }
                    break;
            }
            
            if (moved) {
                updateBackgroundPosition();
                checkQuestTriggers();
            }
        }
        
        function updateBackgroundPosition() {
            const scrollingBackground = document.getElementById('scrollingBackground');
            
            // Create infinite scrolling by resetting position when needed
            const maxOffset = window.innerWidth * 6; // Reset after 6 screen widths (for 800% width background)
            if (backgroundOffset <= -maxOffset) {
                backgroundOffset = 0;
            }
            
            scrollingBackground.style.transform = `translateX(${backgroundOffset}px)`;
            
            // Update distance counter
            const distanceCounter = document.getElementById('distanceCounter');
            if (distanceCounter) {
                distanceCounter.textContent = Math.floor(totalDistance / 10);
            }
        }
        
        function checkQuestTriggers() {
            for (let trigger of questTriggers) {
                if (!trigger.triggered && totalDistance >= trigger.distance) {
                    trigger.triggered = true;
                    showQuest(trigger.questIndex);
                    break; // Only show one quest at a time
                }
            }
        }
        
        function showQuest(questIndex) {
            if (questIndex < quests.length) {
                const quest = quests[questIndex];
                
                // Update quest content with dynamic role name for final quest
                let questContent = quest.content;
                if (quest.isFinal) {
                    questContent = `Selamat!! Semua perkenalan tentang Thirdia Chronicles sudah kamu selesaikan sebagai seorang ${selectedRoleName}. Sekarang kamu siap untuk melanjutkan petualanganmu menjadi ${selectedRoleName} selama 1 tahun ini di kelas 3! Tekan tombol DAFTAR dibawah untuk mendaftarkan dirimu sebagai seorang Petualang baru di Kerajaan Thirdia`;
                }
                
                document.getElementById('questTitle').textContent = quest.title;
                document.getElementById('questContent').textContent = questContent;
                
                // Show appropriate button
                if (quest.isFinal) {
                    document.getElementById('continueQuestBtn').classList.add('hidden');
                    document.getElementById('registerBtn').classList.remove('hidden');
                } else {
                    document.getElementById('continueQuestBtn').classList.remove('hidden');
                    document.getElementById('registerBtn').classList.add('hidden');
                }
                
                document.getElementById('questModal').classList.remove('hidden');
                
                // Update quest counter
                completedQuests++;
                updateQuestCounter();
            }
        }
        
        function updateQuestCounter() {
            const questCounter = document.getElementById('questCounter');
            if (questCounter) {
                questCounter.textContent = completedQuests;
            }
        }
        
        async function registerAsAdventurer() {
            // Send completion status to Google Sheets
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyrNEa1Zi_wn4DVe3GMiGQ8PU3HZUZLR_Jbdp8WsTsIjvq-CBxX6sFxKf22xnXlhSqW1g/exec';
            
            const data = {
                timestamp: new Date().toLocaleString('id-ID'),
                playerName: playerName,
                gender: playerGender,
                selectedRole: selectedRoleName,
                userAgent: navigator.userAgent,
                status: `${playerName} Telah Menyelesaikan Petualangan Pertama di Thirdia Chronicles Sebagai Seorang ${selectedRoleName}`
            };
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Status pendaftaran berhasil dikirim!', data);
                
                // Show success message and start platformer game
                alert(`🎉 Selamat ${playerName}! Kamu telah terdaftar sebagai ${selectedRoleName} di Kerajaan Thirdia Chronicles! Petualangan platformer dimulai!`);
                
                // Close modal and start platformer
                closeQuest();
                startPlatformerGame();
                
            } catch (error) {
                console.error('Error mengirim status pendaftaran:', error);
                alert('Pendaftaran berhasil! Selamat bergabung di Thirdia Chronicles! Petualangan platformer dimulai!');
                closeQuest();
                startPlatformerGame();
            }
        }
        
        function closeQuest() {
            document.getElementById('questModal').classList.add('hidden');
        }
        
        // Add event handlers for buttons
        document.addEventListener('DOMContentLoaded', function() {
            // Continue Quest Button
            const continueBtn = document.getElementById('continueQuestBtn');
            if (continueBtn) {
                continueBtn.addEventListener('click', function() {
                    closeQuest();
                });
            }
            
            // Register Button
            const registerBtn = document.getElementById('registerBtn');
            if (registerBtn) {
                registerBtn.addEventListener('click', function() {
                    registerAsAdventurer();
                });
            }
        });
        
        // Fullscreen functionality
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                // Enter fullscreen
                document.documentElement.requestFullscreen().then(() => {
                    updateFullscreenIcon(true);
                }).catch(err => {
                    console.log('Error attempting to enable fullscreen:', err);
                });
            } else {
                // Exit fullscreen
                document.exitFullscreen().then(() => {
                    updateFullscreenIcon(false);
                }).catch(err => {
                    console.log('Error attempting to exit fullscreen:', err);
                });
            }
        }
        
        function updateFullscreenIcon(isFullscreen) {
            const fullscreenIcon = document.getElementById('fullscreenIcon');
            
            if (isFullscreen) {
                // Show compress/exit fullscreen icon
                fullscreenIcon.innerHTML = '<path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>';
            } else {
                // Show expand/enter fullscreen icon
                fullscreenIcon.innerHTML = '<path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>';
            }
        }
        
        // Listen for fullscreen changes (including F11 key or browser controls)
        document.addEventListener('fullscreenchange', () => {
            updateFullscreenIcon(!!document.fullscreenElement);
        });
        
        // Platformer Game Variables
        let canvas, ctx;
        let gameRunning = false;
        let currentLevel = 1;
        let maxLevel = 10;
        let player = {
            x: 100,
            y: 300,
            width: 32,
            height: 32,
            velocityX: 0,
            velocityY: 0,
            speed: 2.5, // Increased speed for better gameplay
            acceleration: 0.15, // Faster acceleration
            deceleration: 0.18, // Faster deceleration
            jumpPower: 15,
            onGround: false,
            lives: 5,
            score: 0,
            canDoubleJump: false,
            jumpPressed: false
        };
        
        let camera = { x: 0, y: 0 };
        let obstacles = [];
        let platforms = [];
        let enemies = [];
        let keys = {};
        let gameSpeed = 2;
        let groundLevel = 0;
        let levelWidth = 5000; // Total level width
        let finishLine = 4800; // Finish line position
        
        // Level configurations
        let levelConfigs = {
            1: { timeOfDay: 'morning', enemyType: 'slime', skyColor: ['#87CEEB', '#98FB98', '#228B22'] },
            2: { timeOfDay: 'day', enemyType: 'slime', skyColor: ['#87CEEB', '#98FB98', '#228B22'] },
            3: { timeOfDay: 'afternoon', enemyType: 'slime', skyColor: ['#FFB347', '#FFA500', '#FF8C00'] },
            4: { timeOfDay: 'evening', enemyType: 'wolf', skyColor: ['#FF6347', '#FF4500', '#DC143C'] },
            5: { timeOfDay: 'dusk', enemyType: 'wolf', skyColor: ['#8B008B', '#4B0082', '#2F4F4F'] },
            6: { timeOfDay: 'night', enemyType: 'wolf', skyColor: ['#191970', '#000080', '#2F4F4F'] },
            7: { timeOfDay: 'midnight', enemyType: 'goblin', skyColor: ['#000000', '#1a1a2e', '#16213e'] },
            8: { timeOfDay: 'late_night', enemyType: 'goblin', skyColor: ['#0f0f23', '#1a1a3e', '#2d1b69'] },
            9: { timeOfDay: 'dawn', enemyType: 'goblin', skyColor: ['#4B0082', '#8B008B', '#FF1493'] },
            10: { timeOfDay: 'boss', enemyType: 'orc', skyColor: ['#8B0000', '#DC143C', '#B22222'] }
        };
        
        // Platformer Game Functions
        function startPlatformerGame() {
            // Hide all other sections
            document.getElementById('characterCreation').classList.add('hidden');
            document.getElementById('roleSelection').classList.add('hidden');
            document.getElementById('kingdomExploration').classList.add('hidden');
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('questModal').classList.add('hidden');
            
            // Show platformer game
            document.getElementById('platformerGame').classList.remove('hidden');
            
            // Initialize game
            initializePlatformerGame();
        }
        
        function initializePlatformerGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas size
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Display player info with appropriate icon
            let genderIcon;
            if (selectedRoleName === 'Raja Thirdia') {
                genderIcon = '👑'; // Crown for King
            } else {
                genderIcon = playerGender === 'Pria' ? '👨‍⚔️' : '👩‍⚔️';
            }
            
            document.getElementById('platformerPlayerInfo').innerHTML = 
                `${genderIcon} ${playerName}<br><span class="text-green-400">${selectedRoleName}</span><br><span class="text-yellow-400">Level ${currentLevel}</span>`;
            
            // Reset game state
            player.x = 100;
            player.y = 300;
            player.velocityX = 0;
            player.velocityY = 0;
            player.lives = 5;
            player.score = 0;
            player.onGround = false;
            player.canDoubleJump = false;
            player.jumpPressed = false;
            
            camera.x = 0;
            camera.y = 0;
            
            // Generate level
            generateLevel();
            
            // Update UI
            updateLivesDisplay();
            updateScoreDisplay();
            
            // Start game loop
            gameRunning = true;
            gameLoop();
            
            // Setup controls
            setupPlatformerControls();
        }
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        function generateLevel() {
            obstacles = [];
            platforms = [];
            enemies = [];
            
            // Set ground level to bottom of screen
            groundLevel = canvas.height - 40;
            
            // Generate varied ground terrain that connects to screen bottom
            let currentHeight = groundLevel;
            let segmentWidth = 100;
            
            for (let x = 0; x < levelWidth; x += segmentWidth) {
                // Randomly adjust height for terrain variation
                if (Math.random() < 0.3) {
                    let heightChange = (Math.random() - 0.5) * 40; // -20 to +20 pixels
                    currentHeight = Math.max(groundLevel - 60, Math.min(groundLevel + 30, currentHeight + heightChange));
                }
                
                // Create ground segment that extends to bottom of screen
                platforms.push({
                    x: x,
                    y: currentHeight,
                    width: segmentWidth + 5, // Slight overlap
                    height: canvas.height - currentHeight,
                    type: 'ground',
                    terrainHeight: currentHeight
                });
            }
            
            // Generate holes in the ground (Mario-style gaps) - smaller and properly positioned
            let holePositions = [800, 1500, 2200, 2800, 3500, 4000];
            holePositions.forEach((holeX, index) => {
                // Smaller hole width based on player jump capability (player can jump ~120 pixels with double jump)
                let holeWidth = 40 + Math.random() * 15; // 40-55 pixels wide (much smaller)
                
                // Find the exact edges of platforms to create seamless holes
                let leftPlatform = null;
                let rightPlatform = null;
                
                for (let platform of platforms) {
                    if (platform.type === 'ground') {
                        if (platform.x + platform.width <= holeX) {
                            if (!leftPlatform || platform.x > leftPlatform.x) {
                                leftPlatform = platform;
                            }
                        }
                        if (platform.x >= holeX + holeWidth) {
                            if (!rightPlatform || platform.x < rightPlatform.x) {
                                rightPlatform = platform;
                            }
                        }
                    }
                }
                
                // Remove ground platforms in hole area
                platforms = platforms.filter(platform => {
                    return !(platform.x < holeX + holeWidth && platform.x + platform.width > holeX);
                });
                
                // Adjust hole position to connect seamlessly with platforms
                if (leftPlatform) {
                    holeX = leftPlatform.x + leftPlatform.width;
                }
                
                // Add hole marker that extends to bottom of screen
                obstacles.push({
                    x: holeX,
                    y: groundLevel,
                    width: holeWidth,
                    height: canvas.height - groundLevel,
                    type: 'hole'
                });
                
                // Add small platform above some holes (50% chance)
                if (Math.random() < 0.5) {
                    platforms.push({
                        x: holeX + holeWidth/4, // Center the platform over the hole
                        y: groundLevel - 60 - Math.random() * 20, // 60-80 pixels above ground
                        width: holeWidth/2 + 20, // Platform slightly wider than half the hole
                        height: 15,
                        type: 'floating'
                    });
                }
            });
            
            // Generate floating platforms strategically positioned
            for (let i = 0; i < 8; i++) {
                platforms.push({
                    x: 600 + i * 500 + Math.random() * 150, // Less random spread
                    y: groundLevel - 80 - Math.random() * 40, // Lower height (80-120 pixels above ground)
                    width: 80 + Math.random() * 40, // Smaller platforms (80-120 pixels wide)
                    height: 20,
                    type: 'floating'
                });
            }
            
            // Generate enemies based on current level
            let enemyPositions = [600, 1200, 1800, 2500, 3200, 3800];
            let levelConfig = levelConfigs[currentLevel];
            
            enemyPositions.forEach(enemyX => {
                // Find ground height at enemy position
                let groundHeight = groundLevel;
                for (let platform of platforms) {
                    if (platform.type === 'ground' && enemyX >= platform.x && enemyX <= platform.x + platform.width) {
                        groundHeight = platform.y;
                        break;
                    }
                }
                
                let enemySize = 24;
                let enemySpeed = 0.3 + Math.random() * 0.4;
                
                // Adjust enemy properties based on type
                switch(levelConfig.enemyType) {
                    case 'slime':
                        enemySize = 24;
                        enemySpeed = 0.3 + Math.random() * 0.4;
                        break;
                    case 'wolf':
                        enemySize = 28;
                        enemySpeed = 0.5 + Math.random() * 0.3;
                        break;
                    case 'goblin':
                        enemySize = 30;
                        enemySpeed = 0.4 + Math.random() * 0.5;
                        break;
                    case 'orc':
                        enemySize = 48; // 2x larger than player (32x32)
                        enemySpeed = 0.2 + Math.random() * 0.3; // Slower but more dangerous
                        break;
                }
                
                enemies.push({
                    x: enemyX,
                    y: groundHeight - enemySize,
                    width: enemySize,
                    height: enemySize,
                    velocityX: enemySpeed,
                    direction: Math.random() > 0.5 ? 1 : -1,
                    type: levelConfig.enemyType,
                    alive: true,
                    groundY: groundHeight,
                    moveTimer: 0,
                    pauseTimer: 0,
                    isMoving: true,
                    randomFactor: Math.random() * 0.2 + 0.8
                });
            });
        }
        
        function gameLoop() {
            if (!gameRunning) return;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Update game state
            updatePlayer();
            updateEnemies();
            updateCamera();
            
            // Draw game elements
            drawBackground();
            drawPlatforms();
            drawObstacles();
            drawEnemies();
            drawPlayer();
            drawFinishLine();
            
            // Check collisions
            checkCollisions();
            checkEnemyCollisions();
            checkFinishLine();
            
            // Continue loop
            requestAnimationFrame(gameLoop);
        }
        
        function updatePlayer() {
            // Handle input with smooth acceleration/deceleration
            if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                if (player.velocityX > -player.speed) {
                    player.velocityX -= player.acceleration;
                    if (player.velocityX < -player.speed) player.velocityX = -player.speed;
                }
            } else if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                if (player.velocityX < player.speed) {
                    player.velocityX += player.acceleration;
                    if (player.velocityX > player.speed) player.velocityX = player.speed;
                }
            } else {
                // Apply deceleration when no input
                if (player.velocityX > 0) {
                    player.velocityX -= player.deceleration;
                    if (player.velocityX < 0) player.velocityX = 0;
                } else if (player.velocityX < 0) {
                    player.velocityX += player.deceleration;
                    if (player.velocityX > 0) player.velocityX = 0;
                }
            }
            
            // Jumping with double jump
            const jumpKey = keys['ArrowUp'] || keys['w'] || keys['W'] || keys[' '];
            
            if (jumpKey && !player.jumpPressed) {
                if (player.onGround) {
                    // First jump
                    player.velocityY = -player.jumpPower;
                    player.onGround = false;
                    player.canDoubleJump = true;
                } else if (player.canDoubleJump) {
                    // Double jump - slightly higher jump
                    player.velocityY = -player.jumpPower * 1.05;
                    player.canDoubleJump = false;
                }
                player.jumpPressed = true;
            } else if (!jumpKey) {
                player.jumpPressed = false;
            }
            
            // Reset double jump when on ground
            if (player.onGround) {
                player.canDoubleJump = false;
            }
            
            // Gravity
            player.velocityY += 0.8;
            
            // Update position
            player.x += player.velocityX;
            player.y += player.velocityY;
            
            // Update score based on distance
            player.score = Math.max(player.score, Math.floor(player.x / 10));
            updateScoreDisplay();
        }
        
        function updateCamera() {
            // Follow player
            camera.x = player.x - canvas.width / 3;
            camera.y = Math.max(0, player.y - canvas.height / 2);
        }
        
        function drawBackground() {
            // Draw background based on current level
            let levelConfig = levelConfigs[currentLevel];
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, levelConfig.skyColor[0]);
            gradient.addColorStop(0.6, levelConfig.skyColor[1]);
            gradient.addColorStop(1, levelConfig.skyColor[2]);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add stars for night levels
            if (['night', 'midnight', 'late_night', 'dawn'].includes(levelConfig.timeOfDay)) {
                ctx.fillStyle = '#FFFFFF';
                for (let i = 0; i < 50; i++) {
                    const starX = (i * 100 + Math.sin(i) * 50) - (camera.x * 0.1);
                    const starY = 20 + Math.cos(i) * 30;
                    if (starX > -10 && starX < canvas.width + 10) {
                        ctx.beginPath();
                        ctx.arc(starX, starY, 1 + Math.sin(i) * 0.5, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }
            
            // Add moon for night levels
            if (['dusk', 'night', 'midnight', 'late_night'].includes(levelConfig.timeOfDay)) {
                const moonX = canvas.width * 0.8 - (camera.x * 0.05);
                const moonY = 60;
                if (moonX > -50 && moonX < canvas.width + 50) {
                    ctx.fillStyle = '#F0F0F0';
                    ctx.beginPath();
                    ctx.arc(moonX, moonY, 25, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Moon craters
                    ctx.fillStyle = '#D3D3D3';
                    ctx.beginPath();
                    ctx.arc(moonX - 8, moonY - 5, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.arc(moonX + 5, moonY + 8, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // Add sun for day levels
            if (['morning', 'day', 'afternoon'].includes(levelConfig.timeOfDay)) {
                const sunX = canvas.width * 0.8 - (camera.x * 0.05);
                const sunY = 60;
                if (sunX > -50 && sunX < canvas.width + 50) {
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(sunX, sunY, 30, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Sun rays
                    ctx.strokeStyle = '#FFD700';
                    ctx.lineWidth = 3;
                    for (let i = 0; i < 8; i++) {
                        const angle = (i * Math.PI * 2) / 8;
                        const rayStartX = sunX + Math.cos(angle) * 35;
                        const rayStartY = sunY + Math.sin(angle) * 35;
                        const rayEndX = sunX + Math.cos(angle) * 45;
                        const rayEndY = sunY + Math.sin(angle) * 45;
                        
                        ctx.beginPath();
                        ctx.moveTo(rayStartX, rayStartY);
                        ctx.lineTo(rayEndX, rayEndY);
                        ctx.stroke();
                    }
                }
            }
            
            // Draw bigger trees in background at ground level
            for (let i = 0; i < 80; i++) {
                const treeX = i * 200 - camera.x * 0.3;
                
                // Find ground height at tree position
                let treeGroundY = groundLevel;
                for (let platform of platforms) {
                    if (platform.type === 'ground' && (i * 200) >= platform.x && (i * 200) <= platform.x + platform.width) {
                        treeGroundY = platform.y;
                        break;
                    }
                }
                
                const screenTreeY = treeGroundY - camera.y;
                
                if (treeX > -150 && treeX < canvas.width + 150) {
                    // Tree trunk (bigger) - positioned to sit on ground
                    ctx.fillStyle = '#8B4513';
                    ctx.fillRect(treeX, screenTreeY - 120, 30, 120);
                    
                    // Tree leaves (much bigger)
                    ctx.fillStyle = '#228B22';
                    ctx.beginPath();
                    ctx.arc(treeX + 15, screenTreeY - 140, 50, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Additional leaf layers for fuller look
                    ctx.fillStyle = '#32CD32';
                    ctx.beginPath();
                    ctx.arc(treeX + 5, screenTreeY - 130, 35, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(treeX + 25, screenTreeY - 130, 35, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Tree shadow on ground
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                    ctx.ellipse(treeX + 15, screenTreeY, 25, 8, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // Draw distant mountains
            ctx.fillStyle = '#4682B4';
            ctx.beginPath();
            for (let i = 0; i < canvas.width + 200; i += 100) {
                const mountainX = i - (camera.x * 0.1);
                const mountainHeight = 150 + Math.sin(i * 0.01) * 50;
                ctx.lineTo(mountainX, canvas.height - mountainHeight);
            }
            ctx.lineTo(canvas.width + 200, canvas.height);
            ctx.lineTo(-200, canvas.height);
            ctx.closePath();
            ctx.fill();
        }
        
        function drawPlatforms() {
            platforms.forEach(platform => {
                const screenX = platform.x - camera.x;
                const screenY = platform.y - camera.y;
                
                if (screenX > -platform.width && screenX < canvas.width + platform.width) {
                    if (platform.type === 'ground') {
                        // Draw ground with dirt texture
                        ctx.fillStyle = '#8B4513';
                        ctx.fillRect(screenX, screenY, platform.width, platform.height);
                        
                        // Add grass on top
                        ctx.fillStyle = '#228B22';
                        ctx.fillRect(screenX, screenY - 8, platform.width, 8);
                        
                        // Add some grass details
                        ctx.fillStyle = '#32CD32';
                        for (let i = 0; i < platform.width; i += 15) {
                            ctx.fillRect(screenX + i, screenY - 12, 3, 8);
                            ctx.fillRect(screenX + i + 5, screenY - 10, 2, 6);
                            ctx.fillRect(screenX + i + 10, screenY - 11, 2, 7);
                        }
                        
                        // Add dirt pattern
                        ctx.fillStyle = '#654321';
                        for (let i = 0; i < platform.width; i += 20) {
                            for (let j = 10; j < platform.height; j += 15) {
                                ctx.fillRect(screenX + i, screenY + j, 8, 8);
                            }
                        }
                    } else {
                        // Floating platform
                        ctx.fillStyle = '#8B4513';
                        ctx.fillRect(screenX, screenY, platform.width, platform.height);
                        
                        // Add grass on top
                        ctx.fillStyle = '#228B22';
                        ctx.fillRect(screenX, screenY - 5, platform.width, 5);
                        
                        // Platform border
                        ctx.strokeStyle = '#654321';
                        ctx.lineWidth = 2;
                        ctx.strokeRect(screenX, screenY, platform.width, platform.height);
                    }
                }
            });
        }
        
        function drawObstacles() {
            obstacles.forEach(obstacle => {
                const screenX = obstacle.x - camera.x;
                const screenY = obstacle.y - camera.y;
                
                if (screenX > -obstacle.width && screenX < canvas.width + obstacle.width) {
                    if (obstacle.type === 'hole') {
                        // Draw simple hole/gap - just empty space (no fill)
                        // The hole is just the absence of ground, showing the background
                    }
                }
            });
        }
        
        function updateEnemies() {
            enemies.forEach(enemy => {
                if (!enemy.alive) return;
                
                // Update timers
                enemy.moveTimer++;
                
                // Random movement pattern - sometimes pause, sometimes move
                if (enemy.isMoving) {
                    // Move enemy with smooth random variation and sinusoidal speed changes
                    const baseSpeed = enemy.velocityX * enemy.randomFactor;
                    const speedVariation = 0.8 + Math.sin(enemy.moveTimer * 0.05) * 0.2;
                    const currentSpeed = baseSpeed * speedVariation;
                    enemy.x += currentSpeed * enemy.direction;
                    
                    // Randomly pause movement (less frequent for more fluid movement)
                    if (Math.random() < 0.005) {
                        enemy.isMoving = false;
                        enemy.pauseTimer = 30 + Math.random() * 90; // Pause for 0.5-1.5 seconds
                    }
                } else {
                    // Paused - count down pause timer
                    enemy.pauseTimer--;
                    if (enemy.pauseTimer <= 0) {
                        enemy.isMoving = true;
                        // Sometimes change direction when resuming movement
                        if (Math.random() < 0.3) {
                            enemy.direction *= -1;
                        }
                    }
                }
                
                // Check if enemy should turn around (at platform edge or wall)
                let onPlatform = false;
                for (let platform of platforms) {
                    if (platform.type === 'ground' && 
                        enemy.x + enemy.width > platform.x && 
                        enemy.x < platform.x + platform.width &&
                        Math.abs(enemy.y + enemy.height - platform.y) < 5) {
                        onPlatform = true;
                        break;
                    }
                }
                
                // Turn around if at edge or hit wall
                if (!onPlatform || enemy.x <= 0 || enemy.x >= levelWidth - enemy.width) {
                    enemy.direction *= -1;
                    enemy.isMoving = true; // Resume movement when hitting edge
                }
                
                // Occasionally change direction for more random behavior
                if (Math.random() < 0.002) {
                    enemy.direction *= -1;
                    enemy.randomFactor = Math.random() * 0.2 + 0.8; // New random speed
                }
            });
        }
        
        function drawEnemies() {
            enemies.forEach(enemy => {
                if (!enemy.alive) return;
                
                const screenX = enemy.x - camera.x;
                const screenY = enemy.y - camera.y;
                
                if (screenX > -enemy.width && screenX < canvas.width + enemy.width) {
                    switch(enemy.type) {
                        case 'slime':
                            drawSlime(screenX, screenY, enemy);
                            break;
                        case 'wolf':
                            drawWolf(screenX, screenY, enemy);
                            break;
                        case 'goblin':
                            drawGoblin(screenX, screenY, enemy);
                            break;
                        case 'orc':
                            drawOrc(screenX, screenY, enemy);
                            break;
                    }
                }
            });
        }
        
        function drawSlime(screenX, screenY, enemy) {
            // Draw blue slime enemy with wider bottom
            ctx.fillStyle = '#1E90FF'; // Blue color
            
            // Main slime body - wider at bottom, narrower at top
            ctx.beginPath();
            ctx.ellipse(screenX + enemy.width/2, screenY + enemy.height - 6, enemy.width/2 + 2, enemy.height/2 - 2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Slime top part - smaller and rounder
            ctx.beginPath();
            ctx.ellipse(screenX + enemy.width/2, screenY + 8, enemy.width/3, enemy.height/3, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Connect top and bottom smoothly
            ctx.beginPath();
            ctx.ellipse(screenX + enemy.width/2, screenY + enemy.height/2, enemy.width/2.5, enemy.height/2.5, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Water highlight on main body
            ctx.fillStyle = '#87CEEB'; // Light blue highlight
            ctx.beginPath();
            ctx.ellipse(screenX + enemy.width/2, screenY + enemy.height - 8, enemy.width/3, enemy.height/4, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Water shine effect
            ctx.fillStyle = '#E0F6FF';
            ctx.beginPath();
            ctx.ellipse(screenX + enemy.width/2 - 2, screenY + enemy.height - 10, 3, 4, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Slime eyes
            ctx.fillStyle = '#000080';
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/3, screenY + enemy.height/3, 1.5, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(screenX + (enemy.width * 2/3), screenY + enemy.height/3, 1.5, 0, Math.PI * 2);
            ctx.fill();
            
            // Eye shine
            ctx.fillStyle = '#FFFFFF';
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/3 + 0.5, screenY + enemy.height/3 - 0.5, 0.5, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(screenX + (enemy.width * 2/3) + 0.5, screenY + enemy.height/3 - 0.5, 0.5, 0, Math.PI * 2);
            ctx.fill();
            
            // Slime mouth
            ctx.fillStyle = '#000080';
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/2, screenY + enemy.height/2, 1.5, 0, Math.PI);
            ctx.fill();
            
            // Bounce effect
            if (enemy.isMoving) {
                const bounceOffset = Math.sin(enemy.moveTimer * 0.2) * 1;
                ctx.fillStyle = 'rgba(30, 144, 255, 0.3)';
                ctx.beginPath();
                ctx.ellipse(screenX + enemy.width/2, screenY + enemy.height - 4 + bounceOffset, enemy.width/2 + 1, 2, 0, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function drawWolf(screenX, screenY, enemy) {
            // Wolf body
            ctx.fillStyle = '#696969'; // Dark gray
            ctx.fillRect(screenX + 4, screenY + enemy.height - 16, enemy.width - 8, 12);
            
            // Wolf head
            ctx.fillStyle = '#808080'; // Gray
            ctx.fillRect(screenX + enemy.width - 12, screenY + enemy.height - 20, 10, 8);
            
            // Wolf ears
            ctx.fillStyle = '#696969';
            ctx.beginPath();
            ctx.moveTo(screenX + enemy.width - 10, screenY + enemy.height - 20);
            ctx.lineTo(screenX + enemy.width - 8, screenY + enemy.height - 24);
            ctx.lineTo(screenX + enemy.width - 6, screenY + enemy.height - 20);
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(screenX + enemy.width - 6, screenY + enemy.height - 20);
            ctx.lineTo(screenX + enemy.width - 4, screenY + enemy.height - 24);
            ctx.lineTo(screenX + enemy.width - 2, screenY + enemy.height - 20);
            ctx.fill();
            
            // Wolf legs
            ctx.fillStyle = '#696969';
            ctx.fillRect(screenX + 6, screenY + enemy.height - 8, 3, 8);
            ctx.fillRect(screenX + 12, screenY + enemy.height - 8, 3, 8);
            ctx.fillRect(screenX + enemy.width - 12, screenY + enemy.height - 8, 3, 8);
            ctx.fillRect(screenX + enemy.width - 6, screenY + enemy.height - 8, 3, 8);
            
            // Wolf tail
            ctx.fillStyle = '#808080';
            ctx.fillRect(screenX + 2, screenY + enemy.height - 14, 6, 3);
            
            // Wolf eyes
            ctx.fillStyle = '#FF0000'; // Red eyes
            ctx.beginPath();
            ctx.arc(screenX + enemy.width - 8, screenY + enemy.height - 16, 1, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(screenX + enemy.width - 5, screenY + enemy.height - 16, 1, 0, Math.PI * 2);
            ctx.fill();
            
            // Wolf nose
            ctx.fillStyle = '#000000';
            ctx.beginPath();
            ctx.arc(screenX + enemy.width - 2, screenY + enemy.height - 14, 0.5, 0, Math.PI * 2);
            ctx.fill();
        }
        
        function drawGoblin(screenX, screenY, enemy) {
            // Goblin body
            ctx.fillStyle = '#228B22'; // Green
            ctx.fillRect(screenX + 6, screenY + enemy.height - 20, enemy.width - 12, 16);
            
            // Goblin head
            ctx.fillStyle = '#32CD32'; // Light green
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/2, screenY + enemy.height - 22, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // Goblin ears (pointed)
            ctx.fillStyle = '#228B22';
            ctx.beginPath();
            ctx.moveTo(screenX + enemy.width/2 - 8, screenY + enemy.height - 22);
            ctx.lineTo(screenX + enemy.width/2 - 12, screenY + enemy.height - 26);
            ctx.lineTo(screenX + enemy.width/2 - 6, screenY + enemy.height - 24);
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(screenX + enemy.width/2 + 8, screenY + enemy.height - 22);
            ctx.lineTo(screenX + enemy.width/2 + 12, screenY + enemy.height - 26);
            ctx.lineTo(screenX + enemy.width/2 + 6, screenY + enemy.height - 24);
            ctx.fill();
            
            // Goblin arms
            ctx.fillStyle = '#32CD32';
            ctx.fillRect(screenX + 2, screenY + enemy.height - 18, 6, 12);
            ctx.fillRect(screenX + enemy.width - 8, screenY + enemy.height - 18, 6, 12);
            
            // Goblin legs
            ctx.fillStyle = '#228B22';
            ctx.fillRect(screenX + 8, screenY + enemy.height - 8, 4, 8);
            ctx.fillRect(screenX + enemy.width - 12, screenY + enemy.height - 8, 4, 8);
            
            // Goblin eyes
            ctx.fillStyle = '#FF0000'; // Red eyes
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/2 - 3, screenY + enemy.height - 24, 1.5, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/2 + 3, screenY + enemy.height - 24, 1.5, 0, Math.PI * 2);
            ctx.fill();
            
            // Goblin weapon (small club)
            ctx.fillStyle = '#8B4513'; // Brown
            ctx.fillRect(screenX + enemy.width - 6, screenY + enemy.height - 28, 2, 12);
            ctx.fillRect(screenX + enemy.width - 8, screenY + enemy.height - 30, 6, 4);
        }
        
        function drawOrc(screenX, screenY, enemy) {
            // Orc body (larger)
            ctx.fillStyle = '#556B2F'; // Dark olive green
            ctx.fillRect(screenX + 8, screenY + enemy.height - 32, enemy.width - 16, 24);
            
            // Orc head (larger)
            ctx.fillStyle = '#6B8E23'; // Olive green
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/2, screenY + enemy.height - 36, 12, 0, Math.PI * 2);
            ctx.fill();
            
            // Orc tusks
            ctx.fillStyle = '#FFFFFF';
            ctx.beginPath();
            ctx.moveTo(screenX + enemy.width/2 - 4, screenY + enemy.height - 32);
            ctx.lineTo(screenX + enemy.width/2 - 2, screenY + enemy.height - 28);
            ctx.lineTo(screenX + enemy.width/2 - 6, screenY + enemy.height - 30);
            ctx.fill();
            
            ctx.beginPath();
            ctx.moveTo(screenX + enemy.width/2 + 4, screenY + enemy.height - 32);
            ctx.lineTo(screenX + enemy.width/2 + 2, screenY + enemy.height - 28);
            ctx.lineTo(screenX + enemy.width/2 + 6, screenY + enemy.height - 30);
            ctx.fill();
            
            // Orc arms (muscular)
            ctx.fillStyle = '#6B8E23';
            ctx.fillRect(screenX, screenY + enemy.height - 30, 10, 20);
            ctx.fillRect(screenX + enemy.width - 10, screenY + enemy.height - 30, 10, 20);
            
            // Orc legs (thick)
            ctx.fillStyle = '#556B2F';
            ctx.fillRect(screenX + 12, screenY + enemy.height - 12, 8, 12);
            ctx.fillRect(screenX + enemy.width - 20, screenY + enemy.height - 12, 8, 12);
            
            // Orc eyes (glowing red)
            ctx.fillStyle = '#FF0000';
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/2 - 4, screenY + enemy.height - 38, 2, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/2 + 4, screenY + enemy.height - 38, 2, 0, Math.PI * 2);
            ctx.fill();
            
            // Eye glow effect
            ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/2 - 4, screenY + enemy.height - 38, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(screenX + enemy.width/2 + 4, screenY + enemy.height - 38, 4, 0, Math.PI * 2);
            ctx.fill();
            
            // Orc weapon (large axe)
            ctx.fillStyle = '#8B4513'; // Brown handle
            ctx.fillRect(screenX + enemy.width - 8, screenY + enemy.height - 45, 3, 20);
            
            // Axe head
            ctx.fillStyle = '#C0C0C0'; // Silver
            ctx.fillRect(screenX + enemy.width - 12, screenY + enemy.height - 48, 10, 8);
            ctx.beginPath();
            ctx.moveTo(screenX + enemy.width - 12, screenY + enemy.height - 44);
            ctx.lineTo(screenX + enemy.width - 16, screenY + enemy.height - 40);
            ctx.lineTo(screenX + enemy.width - 12, screenY + enemy.height - 40);
            ctx.fill();
        }
        
        function drawFinishLine() {
            const screenX = finishLine - camera.x;
            
            if (screenX > -50 && screenX < canvas.width + 50) {
                // Find ground height at finish line
                let finishGroundY = groundLevel;
                for (let platform of platforms) {
                    if (platform.type === 'ground' && finishLine >= platform.x && finishLine <= platform.x + platform.width) {
                        finishGroundY = platform.y;
                        break;
                    }
                }
                
                const screenY = finishGroundY - camera.y;
                
                // Draw finish flag pole
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(screenX, screenY - 150, 8, 150);
                
                // Draw checkered flag
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(screenX + 8, screenY - 150, 60, 40);
                
                // Checkered pattern
                ctx.fillStyle = '#000000';
                for (let i = 0; i < 6; i++) {
                    for (let j = 0; j < 4; j++) {
                        if ((i + j) % 2 === 0) {
                            ctx.fillRect(screenX + 8 + i * 10, screenY - 150 + j * 10, 10, 10);
                        }
                    }
                }
                
                // Flag text
                ctx.fillStyle = '#FF0000';
                ctx.font = 'bold 12px Arial';
                ctx.fillText('FINISH', screenX + 15, screenY - 125);
                
                // Finish line on ground
                ctx.fillStyle = '#FFFF00';
                ctx.fillRect(screenX - 5, screenY - 8, 10, 8);
                
                // Finish line stripes
                ctx.fillStyle = '#FF0000';
                for (let i = 0; i < 8; i += 2) {
                    ctx.fillRect(screenX - 5, screenY - 8 + i, 10, 1);
                }
            }
        }
        
        function drawPlayer() {
            const screenX = player.x - camera.x;
            const screenY = player.y - camera.y;
            
            // Draw player character based on role
            if (selectedRoleName === 'Raja Thirdia') {
                // Draw King character
                ctx.fillStyle = '#7c2d12'; // Royal robe color
                ctx.fillRect(screenX, screenY, player.width, player.height);
                
                // Add crown
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(screenX + 5, screenY - 5, 30, 8);
                
                // Crown points
                ctx.fillRect(screenX + 8, screenY - 10, 4, 5);
                ctx.fillRect(screenX + 18, screenY - 12, 4, 7);
                ctx.fillRect(screenX + 28, screenY - 10, 4, 5);
                
                // Face
                ctx.fillStyle = '#FFE4B5';
                ctx.fillRect(screenX + 5, screenY + 5, 30, 20);
                
                // Beard
                ctx.fillStyle = '#E6E6E6';
                ctx.fillRect(screenX + 8, screenY + 20, 24, 8);
                
                // Eyes
                ctx.fillStyle = '#000000';
                ctx.fillRect(screenX + 10, screenY + 10, 3, 3);
                ctx.fillRect(screenX + 22, screenY + 10, 3, 3);
                
                // Royal emblem
                ctx.fillStyle = '#FFD700';
                ctx.fillRect(screenX + 17, screenY + 30, 6, 6);
                
            } else {
                // Draw regular character
                ctx.fillStyle = '#4169E1';
                ctx.fillRect(screenX, screenY, player.width, player.height);
                
                // Add simple face
                ctx.fillStyle = '#FFE4B5';
                ctx.fillRect(screenX + 5, screenY + 5, 30, 20);
                
                // Eyes
                ctx.fillStyle = '#000000';
                ctx.fillRect(screenX + 10, screenY + 10, 3, 3);
                ctx.fillRect(screenX + 22, screenY + 10, 3, 3);
                
                // Add role indicator
                ctx.fillStyle = '#FFD700';
                ctx.font = '12px Arial';
                ctx.fillText(selectedRoleName.charAt(0), screenX + 15, screenY - 5);
            }
        }
        
        function checkCollisions() {
            player.onGround = false;
            
            // Platform collisions
            platforms.forEach(platform => {
                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y < platform.y + platform.height &&
                    player.y + player.height > platform.y) {
                    
                    // Landing on top of platform
                    if (player.velocityY > 0 && player.y < platform.y) {
                        player.y = platform.y - player.height;
                        player.velocityY = 0;
                        player.onGround = true;
                    }
                    // Hit platform from below
                    else if (player.velocityY < 0 && player.y > platform.y) {
                        player.y = platform.y + platform.height;
                        player.velocityY = 0;
                    }
                    // Hit platform from side
                    else if (player.velocityX !== 0) {
                        if (player.x < platform.x) {
                            player.x = platform.x - player.width;
                        } else {
                            player.x = platform.x + platform.width;
                        }
                        player.velocityX = 0;
                    }
                }
            });
            
            // Obstacle collisions (holes)
            obstacles.forEach(obstacle => {
                if (obstacle.type === 'hole' &&
                    player.x < obstacle.x + obstacle.width &&
                    player.x + player.width > obstacle.x &&
                    player.y + player.height > obstacle.y) {
                    
                    // Player fell into hole
                    loseLife();
                }
            });
            
            // Fall off screen
            if (player.y > canvas.height + 100) {
                loseLife();
            }
        }
        
        function checkEnemyCollisions() {
            enemies.forEach(enemy => {
                if (!enemy.alive) return;
                
                // Check collision with player
                if (player.x < enemy.x + enemy.width &&
                    player.x + player.width > enemy.x &&
                    player.y < enemy.y + enemy.height &&
                    player.y + player.height > enemy.y) {
                    
                    // Check if player is jumping on enemy (from above)
                    if (player.velocityY > 0 && player.y < enemy.y - 5) {
                        // Kill enemy
                        enemy.alive = false;
                        player.velocityY = -8; // Small bounce
                        player.score += 100; // Bonus points
                        updateScoreDisplay();
                        
                        // Visual effect (could add particle effect here)
                        console.log('Enemy defeated!');
                    } else {
                        // Player touched enemy from side - lose life
                        loseLife();
                    }
                }
            });
        }
        
        function checkFinishLine() {
            if (player.x + player.width >= finishLine) {
                // Player reached finish line
                gameRunning = false;
                showLevelComplete();
            }
        }
        
        function loseLife() {
            player.lives--;
            updateLivesDisplay();
            
            if (player.lives <= 0) {
                gameOver();
            } else {
                // Respawn player
                player.x = Math.max(100, player.x - 200);
                player.y = 300;
                player.velocityX = 0;
                player.velocityY = 0;
            }
        }
        
        function gameOver() {
            gameRunning = false;
            
            // Show final score and level
            document.getElementById('finalScore').textContent = `Level ${currentLevel} - Skor Akhir: ${player.score}`;
            
            // Show game over modal
            document.getElementById('gameOverModal').classList.remove('hidden');
        }
        
        function restartGame() {
            // Hide game over modal
            document.getElementById('gameOverModal').classList.add('hidden');
            
            // Restart current level (not from beginning)
            initializePlatformerGame();
        }
        
        function showLevelComplete() {
            // Show level complete score
            document.getElementById('levelScore').textContent = `Level ${currentLevel} - Skor: ${player.score}`;
            
            // Update button text based on current level
            const nextLevelBtn = document.querySelector('#levelCompleteModal button');
            if (currentLevel >= maxLevel) {
                nextLevelBtn.textContent = '🏆 SELESAI! MAIN LAGI';
            } else {
                nextLevelBtn.textContent = `🚀 LANJUT LV ${currentLevel + 1}`;
            }
            
            // Show level complete modal
            document.getElementById('levelCompleteModal').classList.remove('hidden');
            
            // Send completion data to Google Sheets
            sendLevelCompletionData();
        }
        
        function nextLevel() {
            // Hide level complete modal
            document.getElementById('levelCompleteModal').classList.add('hidden');
            
            if (currentLevel >= maxLevel) {
                // Completed all levels - restart from level 1
                alert(`🎉 Selamat! Anda telah menyelesaikan semua ${maxLevel} level! Game akan dimulai ulang dari Level 1.`);
                currentLevel = 1;
            } else {
                // Go to next level
                currentLevel++;
                alert(`🚀 Selamat! Melanjutkan ke Level ${currentLevel}!`);
            }
            
            // Initialize next level
            initializePlatformerGame();
        }
        
        function exitGame() {
            // Hide level complete modal
            document.getElementById('levelCompleteModal').classList.add('hidden');
            
            // Return to main menu
            location.reload();
        }
        
        async function sendLevelCompletionData() {
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyrNEa1Zi_wn4DVe3GMiGQ8PU3HZUZLR_Jbdp8WsTsIjvq-CBxX6sFxKf22xnXlhSqW1g/exec';
            
            const data = {
                timestamp: new Date().toLocaleString('id-ID'),
                playerName: playerName,
                gender: playerGender,
                selectedRole: selectedRoleName,
                userAgent: navigator.userAgent,
                status: `${playerName} (${selectedRoleName}) telah menyelesaikan Level ${currentLevel} Platformer dengan skor ${player.score}`,
                score: player.score,
                level: currentLevel
            };
            
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Level completion data sent successfully!', data);
                
            } catch (error) {
                console.error('Error sending level completion data:', error);
            }
        }
        
        function updateLivesDisplay() {
            document.getElementById('livesCounter').textContent = player.lives;
            // Update the total lives display as well
            const livesDisplay = document.getElementById('livesDisplay');
            livesDisplay.innerHTML = `❤️ Nyawa: <span id="livesCounter">${player.lives}</span>/5`;
        }
        
        function updateScoreDisplay() {
            document.getElementById('scoreCounter').textContent = player.score;
        }
        
        function setupPlatformerControls() {
            // Keyboard controls
            document.addEventListener('keydown', (e) => {
                keys[e.key] = true;
                if (e.key === ' ') e.preventDefault(); // Prevent page scroll
            });
            
            document.addEventListener('keyup', (e) => {
                keys[e.key] = false;
            });
            
            // Mobile controls
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            const jumpBtn = document.getElementById('jumpBtn');
            
            // Left button
            leftBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                keys['ArrowLeft'] = true;
            });
            leftBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys['ArrowLeft'] = false;
            });
            leftBtn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                keys['ArrowLeft'] = true;
            });
            leftBtn.addEventListener('mouseup', (e) => {
                e.preventDefault();
                keys['ArrowLeft'] = false;
            });
            
            // Right button
            rightBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                keys['ArrowRight'] = true;
            });
            rightBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys['ArrowRight'] = false;
            });
            rightBtn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                keys['ArrowRight'] = true;
            });
            rightBtn.addEventListener('mouseup', (e) => {
                e.preventDefault();
                keys['ArrowRight'] = false;
            });
            
            // Jump button
            jumpBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                keys[' '] = true;
            });
            jumpBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                keys[' '] = false;
            });
            jumpBtn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                keys[' '] = true;
            });
            jumpBtn.addEventListener('mouseup', (e) => {
                e.preventDefault();
                keys[' '] = false;
            });
        }
        
        // Admin Access Functions
        function showAdminAccess() {
            document.getElementById('adminAccess').classList.remove('hidden');
            document.getElementById('adminCode').focus();
        }
        
        function closeAdminAccess() {
            document.getElementById('adminAccess').classList.add('hidden');
            document.getElementById('adminCode').value = '';
        }
        
        function checkAdminCode() {
            const code = document.getElementById('adminCode').value.toLowerCase();
            const validCodes = [
                'thirdia2024',
                'thirdia2025', 
                'admin123',
                'guru2024',
                'teacher2024'
            ];
            
            if (validCodes.includes(code)) {
                // Set special King character for admin
                playerName = 'Raja Thirdia';
                playerGender = 'Raja';
                selectedRoleName = 'Raja Thirdia';
                
                // Close admin access
                closeAdminAccess();
                
                // Skip directly to platformer game
                alert('👑 Selamat datang, Yang Mulia Raja Thirdia! Akses admin berhasil. Melewati tutorial dan langsung ke permainan platformer!');
                
                // Send admin access log to Google Sheets
                sendAdminAccessLog();
                
                // Start platformer game directly
                setTimeout(() => {
                    startPlatformerGame();
                }, 1000);
                
            } else {
                // Wrong code
                document.getElementById('adminCode').value = '';
                document.getElementById('adminCode').style.borderColor = '#ef4444';
                document.getElementById('adminCode').placeholder = 'Kode salah! Coba lagi...';
                
                setTimeout(() => {
                    document.getElementById('adminCode').style.borderColor = '#6b7280';
                    document.getElementById('adminCode').placeholder = 'Kode Admin...';
                }, 2000);
            }
        }
        
        function createKingCharacterSVG() {
            return `
                <svg viewBox="0 0 120 120" class="w-28 h-34">
                    <!-- King Character -->
                    <!-- Head -->
                    <circle cx="60" cy="30" r="12" fill="#fdbcbc" stroke="#d4a574" stroke-width="1"/>
                    <!-- Beard -->
                    <path d="M48 35 Q60 45 72 35 Q70 50 60 52 Q50 50 48 35" fill="#e6e6e6"/>
                    <!-- Mustache -->
                    <path d="M52 32 Q60 35 68 32 Q65 34 60 34 Q55 34 52 32" fill="#e6e6e6"/>
                    
                    <!-- Royal Crown -->
                    <rect x="48" y="18" width="24" height="8" fill="#ffd700" stroke="#ff8f00" stroke-width="2"/>
                    <!-- Crown Jewels -->
                    <circle cx="52" cy="22" r="2" fill="#dc2626"/>
                    <circle cx="60" cy="22" r="2" fill="#2563eb"/>
                    <circle cx="68" cy="22" r="2" fill="#16a34a"/>
                    <!-- Crown Points -->
                    <polygon points="50,18 52,10 54,18" fill="#ffd700"/>
                    <polygon points="58,18 60,8 62,18" fill="#ffd700"/>
                    <polygon points="66,18 68,10 70,18" fill="#ffd700"/>
                    
                    <!-- Royal Robe -->
                    <path d="M45 42 Q60 40 75 42 L78 88 Q60 92 42 88 Z" fill="#7c2d12" stroke="#92400e" stroke-width="2"/>
                    <!-- Robe Details -->
                    <path d="M50 50 Q60 48 70 50 Q67 65 60 67 Q53 65 50 50" fill="#dc2626" opacity="0.8"/>
                    <!-- Royal Emblem -->
                    <circle cx="60" cy="58" r="5" fill="#ffd700" stroke="#ff8f00" stroke-width="1"/>
                    <polygon points="60,55 58,60 62,60" fill="#dc2626"/>
                    <rect x="59" y="60" width="2" height="4" fill="#dc2626"/>
                    
                    <!-- Arms with Royal Sleeves -->
                    <ellipse cx="40" cy="55" rx="8" ry="18" fill="#7c2d12"/>
                    <ellipse cx="80" cy="55" rx="8" ry="18" fill="#7c2d12"/>
                    <!-- Golden Trim -->
                    <ellipse cx="40" cy="55" rx="6" ry="16" fill="#dc2626" opacity="0.7"/>
                    <ellipse cx="80" cy="55" rx="6" ry="16" fill="#dc2626" opacity="0.7"/>
                    
                    <!-- Royal Scepter -->
                    <rect x="88" y="35" width="4" height="45" fill="#8d6e63"/>
                    <!-- Scepter Top -->
                    <circle cx="90" cy="32" r="6" fill="#ffd700" stroke="#ff8f00" stroke-width="2"/>
                    <circle cx="90" cy="32" r="3" fill="#dc2626"/>
                    <polygon points="90,26 88,30 92,30" fill="#ffd700"/>
                    
                    <!-- Royal Orb -->
                    <circle cx="32" cy="52" r="6" fill="#2563eb" opacity="0.9"/>
                    <circle cx="32" cy="52" r="4" fill="#3b82f6"/>
                    <circle cx="32" cy="52" r="2" fill="#e6e6e6"/>
                    <path d="M30 50 L34 50 M32 48 L32 52" stroke="#ffd700" stroke-width="1"/>
                    
                    <!-- Legs -->
                    <rect x="52" y="88" width="7" height="25" fill="#7c2d12"/>
                    <rect x="61" y="88" width="7" height="25" fill="#7c2d12"/>
                    
                    <!-- Royal Boots -->
                    <rect x="49" y="111" width="13" height="8" fill="#ffd700" rx="4"/>
                    <rect x="58" y="111" width="13" height="8" fill="#ffd700" rx="4"/>
                    <!-- Boot Details -->
                    <rect x="51" y="113" width="9" height="4" fill="#ff8f00"/>
                    <rect x="60" y="113" width="9" height="4" fill="#ff8f00"/>
                    
                    <!-- Royal Cape -->
                    <path d="M45 42 Q35 50 38 70 Q45 78 60 75 Q75 78 82 70 Q85 50 75 42" fill="#7c2d12" opacity="0.9"/>
                    <!-- Cape Trim -->
                    <path d="M45 42 Q35 50 38 70" stroke="#ffd700" stroke-width="2" fill="none"/>
                    <path d="M75 42 Q85 50 82 70" stroke="#ffd700" stroke-width="2" fill="none"/>
                    
                    <!-- Royal Aura -->
                    <circle cx="20" cy="35" r="2" fill="#ffd700" opacity="0.8"/>
                    <circle cx="100" cy="45" r="1.5" fill="#ffd700" opacity="0.8"/>
                    <circle cx="25" cy="65" r="1" fill="#ffd700" opacity="0.8"/>
                    <circle cx="95" cy="70" r="2" fill="#ffd700" opacity="0.8"/>
                    <circle cx="15" cy="80" r="1.5" fill="#ffd700" opacity="0.8"/>
                    <circle cx="105" cy="85" r="1" fill="#ffd700" opacity="0.8"/>
                    
                    <!-- Crown Glow -->
                    <circle cx="60" cy="22" r="15" fill="none" stroke="#ffd700" stroke-width="1" opacity="0.5"/>
                    <circle cx="60" cy="22" r="20" fill="none" stroke="#ffd700" stroke-width="0.5" opacity="0.3"/>
                </svg>
            `;
        }

        async function sendAdminAccessLog() {
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyrNEa1Zi_wn4DVe3GMiGQ8PU3HZUZLR_Jbdp8WsTsIjvq-CBxX6sFxKf22xnXlhSqW1g/exec';
            
            const data = {
                timestamp: new Date().toLocaleString('id-ID'),
                playerName: 'RAJA',
                gender: 'Raja',
                selectedRole: 'Raja Thirdia',
                userAgent: navigator.userAgent,
                status: 'ADMIN ACCESS - Raja Thirdia melewati tutorial langsung ke permainan'
            };
            
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                console.log('Admin access logged successfully!', data);
                
            } catch (error) {
                console.error('Error logging admin access:', error);
            }
        }
        
        // Initialize stars when page loads
        window.addEventListener('load', createStars);
        
        // Add keyboard support
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && selectedRoleName) {
                confirmSelection();
            }
            if (e.key === 'Escape') {
                closeModal();
                closeQuest();
                closeAdminAccess();
            }
            
            // Admin access shortcut (Ctrl + Shift + A)
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                showAdminAccess();
            }
            
            // Enter key in admin code input
            if (e.key === 'Enter' && document.getElementById('adminAccess').classList.contains('hidden') === false) {
                e.preventDefault();
                checkAdminCode();
            }
            
            // Fullscreen toggle with F key
            if (e.key === 'f' || e.key === 'F') {
                e.preventDefault();
                toggleFullscreen();
            }
            
            // Keyboard controls for character movement
            if (document.getElementById('kingdomExploration').classList.contains('hidden') === false) {
                switch(e.key) {
                    case 'ArrowLeft':
                    case 'a':
                    case 'A':
                        e.preventDefault();
                        if (!isMoving) startMoving('backward');
                        break;
                    case 'ArrowRight':
                    case 'd':
                    case 'D':
                        e.preventDefault();
                        if (!isMoving) startMoving('forward');
                        break;
                }
            }
        });
        
        document.addEventListener('keyup', function(e) {
            // Stop movement when key is released
            if (document.getElementById('kingdomExploration').classList.contains('hidden') === false) {
                switch(e.key) {
                    case 'ArrowLeft':
                    case 'ArrowRight':
                    case 'a':
                    case 'A':
                    case 'd':
                    case 'D':
                        e.preventDefault();
                        stopMoving();
                        break;
                }
            }
        });
        
        // Mobile touch support - only prevent for specific elements
        document.addEventListener('touchstart', function(e) {
            // Only prevent default for movement buttons, not all touches
            if (e.target.id === 'forwardBtn' || e.target.id === 'backwardBtn') {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('touchend', function(e) {
            // Only prevent default for movement buttons, not all touches
            if (e.target.id === 'forwardBtn' || e.target.id === 'backwardBtn') {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Prevent zoom on double tap for mobile
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // Swipe gestures for mobile movement - only on game area
        let touchStartX = 0;
        let touchStartY = 0;
        let isSwiping = false;
        
        const gameArea = document.getElementById('kingdomExploration');
        
        if (gameArea) {
            gameArea.addEventListener('touchstart', function(e) {
                if (!this.classList.contains('hidden')) {
                    // Only start swipe if not touching buttons or modals
                    if (!e.target.closest('button') && !e.target.closest('#questModal')) {
                        touchStartX = e.touches[0].clientX;
                        touchStartY = e.touches[0].clientY;
                        isSwiping = false;
                    }
                }
            });
            
            gameArea.addEventListener('touchmove', function(e) {
                if (!this.classList.contains('hidden') && touchStartX && touchStartY) {
                    const touchEndX = e.touches[0].clientX;
                    const touchEndY = e.touches[0].clientY;
                    
                    const diffX = touchStartX - touchEndX;
                    const diffY = touchStartY - touchEndY;
                    
                    // Only trigger if horizontal swipe is more significant than vertical
                    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                        if (!isSwiping && !isMoving) {
                            isSwiping = true;
                            if (diffX > 0) {
                                // Swipe left - move backward
                                startMoving('backward');
                            } else {
                                // Swipe right - move forward
                                startMoving('forward');
                            }
                        }
                    }
                }
            });
            
            gameArea.addEventListener('touchend', function(e) {
                if (!this.classList.contains('hidden')) {
                    if (isSwiping) {
                        stopMoving();
                        isSwiping = false;
                    }
                    touchStartX = 0;
                    touchStartY = 0;
                }
            });
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96f4dbea56c444c1',t:'MTc1NTIyMDcxNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
